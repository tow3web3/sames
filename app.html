<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SAMES ‚Äî Fair Launch Pad</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500;600;700&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
*,*::before,*::after{margin:0;padding:0;box-sizing:border-box}
:root{
  --gold:#FFD700;--gold-dim:#C8A800;--gold-glow:rgba(255,215,0,.12);
  --bg:#000;--bg2:#080808;--bg3:#111;--card:#0a0a0a;--card-hover:#0f0f0f;
  --border:#1a1a1a;--border-hover:#2a2a2a;
  --text:#e8e8e8;--text-dim:#666;--text-mid:#999;--white:#fff;
  --green:#00ff88;--green-dim:#00cc6a;--red:#ff4444;--blue:#4488ff;
  --mono:'JetBrains Mono',monospace;--sans:'Space Grotesk',sans-serif;--inter:'Inter',sans-serif;
}
html{background:var(--bg)}
body{font-family:var(--inter);color:var(--text);background:var(--bg);overflow-x:hidden;min-height:100vh}
::selection{background:var(--gold);color:#000}
::-webkit-scrollbar{width:5px}
::-webkit-scrollbar-track{background:#0a0a0a}
::-webkit-scrollbar-thumb{background:#333;border-radius:3px}

/* ‚îÄ‚îÄ LAYOUT: SIDEBAR + MAIN ‚îÄ‚îÄ */
.app-layout{display:flex;min-height:100vh}

/* SIDEBAR */
.sidebar{width:200px;background:var(--bg);border-right:1px solid var(--border);position:fixed;top:0;left:0;bottom:0;z-index:110;display:flex;flex-direction:column;overflow-y:auto;overflow-x:hidden;transition:width .2s ease}
.sidebar.collapsed{width:60px;overflow:visible}
.sidebar-logo{padding:18px 20px;display:flex;align-items:center;gap:10px;border-bottom:1px solid var(--border);min-height:56px}
.sidebar-logo .logo{font-family:var(--sans);font-size:18px;font-weight:700;color:var(--gold);letter-spacing:-0.5px;cursor:pointer;display:flex;align-items:center;gap:8px;white-space:nowrap}
.sidebar.collapsed .sidebar-logo{padding:18px 14px;justify-content:center}
.sidebar.collapsed .logo .logo-text{display:none}
.devnet-badge{font-family:var(--mono);font-size:8px;padding:2px 5px;border-radius:3px;background:rgba(68,136,255,.15);color:var(--blue);border:1px solid rgba(68,136,255,.25);letter-spacing:1px;font-weight:600}
.sidebar.collapsed .devnet-badge{display:none}

.sidebar-toggle{position:absolute;top:18px;right:-12px;width:24px;height:24px;border-radius:50%;background:var(--bg3);border:1px solid var(--border);color:var(--text-dim);cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:12px;transition:all .15s;z-index:1}
.sidebar-toggle:hover{background:var(--gold);color:#000;border-color:var(--gold)}
.sidebar.collapsed .sidebar-toggle{right:-12px}

.sidebar-nav{flex:1;padding:12px 10px;display:flex;flex-direction:column;gap:2px;overflow:visible}
.sidebar-link{font-family:var(--inter);font-size:14px;color:var(--text-dim);text-decoration:none;padding:10px 14px;border-radius:10px;transition:all .15s;cursor:pointer;display:flex;align-items:center;gap:10px;border:none;background:none;width:100%;text-align:left;position:relative;white-space:nowrap}
.sidebar-link:hover{color:var(--text);background:var(--bg3)}
.sidebar-link.active{color:var(--text);background:var(--bg3)}
.sidebar-link .link-icon{font-size:16px;width:20px;text-align:center;flex-shrink:0}
.sidebar-link .link-label{transition:opacity .15s}
.sidebar.collapsed .sidebar-link{justify-content:center;padding:10px}
.sidebar.collapsed .sidebar-link .link-label{opacity:0;width:0;overflow:hidden}

/* Tooltip on hover when collapsed */
.sidebar.collapsed .sidebar-link::after{content:attr(data-tip);position:absolute;left:56px;top:50%;transform:translateY(-50%);font-family:var(--inter);font-size:12px;font-weight:500;color:var(--text);background:#1a1a1a;border:1px solid var(--border);padding:6px 12px;border-radius:8px;white-space:nowrap;pointer-events:none;opacity:0;transition:opacity .15s .1s;z-index:999;box-shadow:0 4px 12px rgba(0,0,0,.5)}
.sidebar.collapsed .sidebar-link:hover::after{opacity:1}
.sidebar.collapsed .sidebar-create::after{content:attr(data-tip);position:absolute;left:56px;top:50%;transform:translateY(-50%);font-family:var(--inter);font-size:12px;font-weight:600;color:#000;background:var(--gold);padding:6px 12px;border-radius:8px;white-space:nowrap;pointer-events:none;opacity:0;transition:opacity .15s .1s;z-index:999;box-shadow:0 4px 12px rgba(255,215,0,.3)}
.sidebar.collapsed .sidebar-create:hover::after{opacity:1}

.sidebar-create{margin:8px 10px;padding:12px 14px;border-radius:10px;border:none;font-family:var(--sans);font-size:14px;font-weight:600;background:var(--gold);color:#000;cursor:pointer;transition:all .15s;display:flex;align-items:center;gap:8px;justify-content:center;position:relative;white-space:nowrap;overflow:hidden}
.sidebar-create:hover{box-shadow:0 0 20px rgba(255,215,0,.25)}
.sidebar.collapsed .sidebar-create .create-label{display:none}
.sidebar.collapsed .sidebar-create{padding:12px;margin:8px 6px}

.sidebar-bottom{padding:12px 10px;border-top:1px solid var(--border)}
.sidebar.collapsed .sidebar-bottom .sidebar-link{justify-content:center}

/* MAIN CONTENT */
.main-content{flex:1;margin-left:200px;min-width:0;transition:margin-left .2s ease}
body.sb-collapsed .main-content{margin-left:60px}

/* TOP BAR (simplified ‚Äî no nav, just search + wallet) */
.topbar{position:sticky;top:0;z-index:100;background:rgba(0,0,0,.85);backdrop-filter:blur(20px);border-bottom:1px solid var(--border);padding:0 24px;height:56px;display:flex;align-items:center;justify-content:space-between}
.topbar-left{display:flex;align-items:center;gap:16px;flex:1}
.topbar-search{font-family:var(--mono);font-size:12px;padding:8px 14px 8px 32px;border-radius:8px;border:1px solid var(--border);background:var(--bg2);color:var(--text);outline:none;width:280px;transition:border-color .15s;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='14' height='14' fill='%23666' viewBox='0 0 24 24'%3E%3Cpath d='M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z' stroke='%23666' stroke-width='2' fill='none' stroke-linecap='round'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:10px center}
.topbar-search::placeholder{color:var(--text-dim)}
.topbar-search:focus{border-color:var(--gold)}
.topbar-right{display:flex;align-items:center;gap:12px}
.wallet-btn{font-family:var(--mono);font-size:12px;padding:8px 16px;border-radius:8px;border:1px solid var(--gold);color:var(--gold);background:transparent;cursor:pointer;transition:all .15s}
.wallet-btn:hover{background:rgba(255,215,0,.08)}
.wallet-btn.connected{border-color:var(--green);color:var(--green)}

/* Hide old nav and create btn in topbar */
.nav{display:none}
.create-btn{display:none}

/* Mobile: auto-collapse sidebar */
@media(max-width:768px){
  .sidebar:not(.collapsed){width:60px}
  .sidebar:not(.collapsed) .logo-text,.sidebar:not(.collapsed) .link-label,.sidebar:not(.collapsed) .create-label{display:none}
  .sidebar:not(.collapsed) .sidebar-link{justify-content:center;padding:10px}
  .sidebar:not(.collapsed) .sidebar-create{padding:12px;margin:8px 6px}
  .main-content{margin-left:60px}
}

/* FILTERS */
.filters{padding:16px 24px;display:flex;align-items:center;gap:12px;border-bottom:1px solid var(--border);overflow-x:auto}
.filter-chip{font-family:var(--mono);font-size:11px;padding:6px 14px;border-radius:6px;border:1px solid var(--border);color:var(--text-dim);background:transparent;cursor:pointer;white-space:nowrap;transition:all .15s;letter-spacing:.5px}
.filter-chip:hover{border-color:var(--border-hover);color:var(--text)}
.filter-chip.active{border-color:var(--gold);color:var(--gold);background:rgba(255,215,0,.05)}
.filter-search{font-family:var(--mono);font-size:12px;padding:6px 14px;border-radius:6px;border:1px solid var(--border);color:var(--text);background:var(--bg2);outline:none;width:200px;margin-left:auto}
.filter-search::placeholder{color:var(--text-dim)}
.filter-search:focus{border-color:var(--gold)}

/* LIVE STATS TICKER */
.ticker{padding:10px 24px;display:flex;gap:24px;border-bottom:1px solid var(--border);overflow-x:auto}
.ticker-item{font-family:var(--mono);font-size:11px;color:var(--text-dim);white-space:nowrap;display:flex;align-items:center;gap:6px}
.ticker-val{color:var(--text);font-weight:600}
.ticker-green{color:var(--green)}
.ticker-gold{color:var(--gold)}

/* TOKEN GRID */
.grid-container{padding:20px}
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:14px}

/* TOKEN CARD */
.card{background:var(--card);border:1px solid var(--border);border-radius:14px;overflow:hidden;cursor:pointer;transition:all .25s;position:relative}
.card:hover{border-color:var(--border-hover);transform:translateY(-3px) scale(1.01);box-shadow:0 12px 40px rgba(0,0,0,.5)}
.card.presale{border-color:rgba(255,215,0,.15)}
.card.presale:hover{border-color:rgba(255,215,0,.3);box-shadow:0 12px 40px rgba(255,215,0,.08)}
.card.live{border-color:rgba(0,255,136,.1)}
.card.live:hover{border-color:rgba(0,255,136,.25);box-shadow:0 12px 40px rgba(0,255,136,.06)}

.card-header{padding:14px 16px 10px;display:flex;align-items:center;gap:12px}
.token-avatar{width:40px;height:40px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:20px;flex-shrink:0}
.card-info{flex:1;min-width:0}
.card-info h3{font-family:var(--sans);font-size:15px;font-weight:600;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.card-info .ticker-name{font-family:var(--mono);font-size:11px;color:var(--text-dim)}
.card-status{font-family:var(--mono);font-size:10px;padding:3px 8px;border-radius:5px;letter-spacing:.5px;font-weight:600;flex-shrink:0}
.status-presale{background:rgba(255,215,0,.1);color:var(--gold);border:1px solid rgba(255,215,0,.15)}
.status-live{background:rgba(0,255,136,.1);color:var(--green);border:1px solid rgba(0,255,136,.15)}
.status-ended{background:rgba(102,102,102,.1);color:var(--text-dim);border:1px solid rgba(102,102,102,.15)}

.card-countdown{padding:6px 16px 12px;text-align:center}
.countdown-timer{font-family:var(--mono);font-size:28px;font-weight:700;color:var(--gold);text-shadow:0 0 20px rgba(255,215,0,.2);letter-spacing:2px}
.countdown-label{font-family:var(--mono);font-size:9px;color:var(--text-dim);letter-spacing:2px;text-transform:uppercase;margin-top:2px}
.card.live .countdown-timer{color:var(--green);text-shadow:0 0 20px rgba(0,255,136,.2)}

.card-progress{padding:0 16px;margin-bottom:10px}
.progress-bar{height:4px;background:var(--bg3);border-radius:2px;overflow:hidden}
.progress-fill{height:100%;border-radius:2px;transition:width .5s ease}
.presale .progress-fill{background:linear-gradient(90deg,var(--gold-dim),var(--gold))}
.live .progress-fill{background:linear-gradient(90deg,var(--green-dim),var(--green))}

.card-stats{padding:8px 16px 14px;display:grid;grid-template-columns:1fr 1fr 1fr;gap:6px}
.card-stat{text-align:center}
.card-stat .s-label{font-family:var(--mono);font-size:9px;color:var(--text-dim);letter-spacing:.5px;text-transform:uppercase}
.card-stat .s-value{font-family:var(--mono);font-size:13px;font-weight:600;color:var(--text);margin-top:1px}
.s-green{color:var(--green)!important}
.s-gold{color:var(--gold)!important}

.card-footer{padding:10px 16px;border-top:1px solid var(--border);display:flex;align-items:center;justify-content:space-between}
.card-footer .creator{font-family:var(--mono);font-size:10px;color:var(--text-dim)}
.card-footer .time-ago{font-family:var(--mono);font-size:10px;color:var(--text-dim)}
.card-footer .mint-addr{font-family:var(--mono);font-size:9px;color:var(--text-dim);opacity:.6}
.floor-badge{font-family:var(--mono);font-size:10px;padding:2px 8px;border-radius:4px;background:rgba(255,215,0,.06);color:var(--gold);border:1px solid rgba(255,215,0,.1)}

/* ‚îÄ‚îÄ CHAT ‚îÄ‚îÄ */
.chat-panel{background:var(--card);border:1px solid var(--border);border-radius:14px;overflow:hidden;margin-top:20px}
.chat-header{padding:14px 16px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between}
.chat-header h3{font-family:var(--sans);font-size:14px;font-weight:600;color:var(--text-mid)}
.chat-header .chat-count{font-family:var(--mono);font-size:11px;color:var(--text-dim)}
.chat-messages{max-height:400px;overflow-y:auto;padding:12px 16px;display:flex;flex-direction:column;gap:10px}
.chat-empty{text-align:center;padding:32px;color:var(--text-dim);font-family:var(--inter);font-size:13px}
.chat-msg{display:flex;gap:10px;align-items:flex-start}
.chat-pfp{width:32px;height:32px;border-radius:50%;background:var(--bg3);flex-shrink:0;overflow:hidden;display:flex;align-items:center;justify-content:center;font-size:14px}
.chat-pfp img{width:100%;height:100%;object-fit:cover}
.chat-msg-body{flex:1;min-width:0}
.chat-msg-header{display:flex;align-items:center;gap:8px;margin-bottom:2px}
.chat-msg-user{font-family:var(--mono);font-size:12px;font-weight:600;color:var(--gold)}
.chat-msg-wallet{font-family:var(--mono);font-size:10px;color:var(--text-dim)}
.chat-msg-time{font-family:var(--mono);font-size:10px;color:var(--text-dim);margin-left:auto}
.chat-msg-text{font-family:var(--inter);font-size:13px;color:var(--text);line-height:1.5;word-break:break-word}
.chat-input-area{padding:12px 16px;border-top:1px solid var(--border);display:flex;gap:8px}
.chat-input{flex:1;font-family:var(--inter);font-size:13px;padding:10px 14px;border-radius:10px;border:1px solid var(--border);background:var(--bg2);color:var(--text);outline:none;resize:none;min-height:40px;max-height:80px}
.chat-input:focus{border-color:var(--gold)}
.chat-input::placeholder{color:#444}
.chat-send{font-family:var(--sans);font-size:13px;font-weight:600;padding:10px 18px;border-radius:10px;border:none;background:var(--gold);color:#000;cursor:pointer;transition:all .15s;flex-shrink:0}
.chat-send:hover{box-shadow:0 0 16px rgba(255,215,0,.25)}
.chat-send:disabled{opacity:.4;cursor:not-allowed}

/* ‚îÄ‚îÄ PROFILE MODAL ‚îÄ‚îÄ */
.profile-modal{position:fixed;inset:0;background:rgba(0,0,0,.8);backdrop-filter:blur(8px);z-index:250;display:none;align-items:center;justify-content:center}
.profile-modal.open{display:flex}
.profile-modal-inner{background:#0a0a0a;border:1px solid var(--border);border-radius:16px;padding:28px;width:90%;max-width:400px}
.profile-modal-inner h2{font-family:var(--sans);font-size:20px;font-weight:700;color:var(--gold);margin-bottom:20px}
.pfp-upload-area{width:80px;height:80px;border-radius:50%;background:var(--bg3);margin:0 auto 16px;cursor:pointer;overflow:hidden;display:flex;align-items:center;justify-content:center;font-size:32px;border:2px dashed var(--border);transition:border-color .15s}
.pfp-upload-area:hover{border-color:var(--gold)}
.pfp-upload-area img{width:100%;height:100%;object-fit:cover}

/* ‚îÄ‚îÄ CREATE PAGE ‚îÄ‚îÄ */
.create-page{max-width:960px;margin:0 auto;padding:32px 24px 80px}
.create-page h1{font-family:var(--sans);font-size:28px;font-weight:700;margin-bottom:4px}
.create-page .subtitle{font-family:var(--inter);font-size:14px;color:var(--text-dim);margin-bottom:32px}
.create-layout{display:grid;grid-template-columns:1fr 300px;gap:32px}
.create-form{}
.create-preview{position:sticky;top:76px}

.form-section{background:var(--card);border:1px solid var(--border);border-radius:14px;padding:24px;margin-bottom:20px}
.form-section h3{font-family:var(--sans);font-size:16px;font-weight:600;margin-bottom:16px}
.form-row{display:grid;grid-template-columns:1fr 1fr;gap:14px;margin-bottom:14px}
.form-group{display:flex;flex-direction:column;gap:4px;margin-bottom:14px}
.form-group:last-child{margin-bottom:0}
.form-group label{font-family:var(--mono);font-size:11px;color:var(--text-dim);letter-spacing:.5px}
.form-group input,.form-group textarea{font-family:var(--inter);font-size:14px;padding:12px 14px;border-radius:10px;border:1px solid var(--border);background:var(--bg2);color:var(--text);outline:none;transition:border-color .15s}
.form-group input:focus,.form-group textarea:focus{border-color:var(--gold)}
.form-group textarea{resize:vertical;min-height:80px;font-size:13px}
.form-group input::placeholder,.form-group textarea::placeholder{color:#444}
.form-group .char-count{font-family:var(--mono);font-size:10px;color:var(--text-dim);text-align:right;margin-top:2px}

.social-toggle{font-family:var(--mono);font-size:12px;color:var(--gold);cursor:pointer;display:inline-flex;align-items:center;gap:6px;padding:6px 0;border:none;background:none;transition:color .15s}
.social-toggle:hover{color:var(--gold-dim)}
.social-fields{display:none;margin-top:12px}
.social-fields.open{display:block}

.image-upload{border:2px dashed var(--border);border-radius:14px;padding:40px 24px;text-align:center;cursor:pointer;transition:all .2s;position:relative;overflow:hidden}
.image-upload:hover{border-color:var(--border-hover);background:rgba(255,255,255,.02)}
.image-upload.has-image{border-color:var(--gold);border-style:solid;padding:0}
.image-upload .upload-icon{font-size:36px;margin-bottom:8px;opacity:.6}
.image-upload .upload-text{font-family:var(--sans);font-size:14px;font-weight:500;margin-bottom:4px}
.image-upload .upload-hint{font-family:var(--mono);font-size:11px;color:var(--text-dim)}
.image-upload img{width:100%;height:auto;display:block;border-radius:12px}
.image-upload input[type="file"]{display:none}

.file-specs{display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-top:12px}
.file-spec{display:flex;align-items:flex-start;gap:8px}
.file-spec .spec-icon{font-size:16px;flex-shrink:0;margin-top:2px}
.file-spec .spec-title{font-family:var(--sans);font-size:12px;font-weight:600;margin-bottom:2px}
.file-spec .spec-list{font-family:var(--mono);font-size:10px;color:var(--text-dim);line-height:1.6}

.form-note{font-family:var(--mono);font-size:11px;color:var(--text-dim);padding:12px 16px;border:1px solid var(--border);border-radius:10px;display:flex;align-items:center;gap:8px;margin-bottom:20px}
.form-note .note-icon{font-size:14px;flex-shrink:0}

.create-submit{width:100%;font-family:var(--sans);font-size:16px;font-weight:700;padding:16px;border-radius:12px;border:none;background:var(--gold);color:#000;cursor:pointer;transition:all .2s}
.create-submit:hover{box-shadow:0 0 30px rgba(255,215,0,.3);transform:translateY(-1px)}
.create-submit:disabled{opacity:.5;cursor:not-allowed;transform:none;box-shadow:none}

.preview-card{background:var(--card);border:1px solid var(--border);border-radius:14px;overflow:hidden}
.preview-card .preview-label{font-family:var(--sans);font-size:14px;font-weight:600;padding:16px 16px 12px;color:var(--text-dim)}
.preview-image{width:100%;aspect-ratio:1;background:var(--bg3);display:flex;align-items:center;justify-content:center;color:var(--text-dim);font-family:var(--inter);font-size:13px}
.preview-image img{width:100%;height:100%;object-fit:cover}
.preview-info{padding:14px 16px}
.preview-name{font-family:var(--sans);font-size:16px;font-weight:600;margin-bottom:2px}
.preview-ticker{font-family:var(--mono);font-size:12px;color:var(--text-dim)}
.preview-desc{font-family:var(--inter);font-size:12px;color:var(--text-mid);margin-top:8px;line-height:1.5}
.preview-links{display:flex;gap:8px;margin-top:10px;flex-wrap:wrap}
.preview-link{font-family:var(--mono);font-size:10px;color:var(--gold);padding:3px 8px;border-radius:5px;background:rgba(255,215,0,.06);border:1px solid rgba(255,215,0,.1)}
.preview-stats{display:grid;grid-template-columns:1fr 1fr;gap:8px;padding:12px 16px;border-top:1px solid var(--border)}
.preview-stat{text-align:center}
.preview-stat .ps-label{font-family:var(--mono);font-size:9px;color:var(--text-dim);letter-spacing:.5px}
.preview-stat .ps-val{font-family:var(--mono);font-size:13px;font-weight:600;color:var(--gold);margin-top:2px}

@media(max-width:768px){
  .create-layout{grid-template-columns:1fr}
  .create-preview{position:static}
  .form-row{grid-template-columns:1fr}
}

/* ‚îÄ‚îÄ TOASTS ‚îÄ‚îÄ */
.toast-container{position:fixed;top:72px;right:20px;z-index:300;display:flex;flex-direction:column;gap:8px;pointer-events:none}
.toast{pointer-events:auto;font-family:var(--inter);font-size:13px;padding:14px 20px;border-radius:12px;backdrop-filter:blur(20px);box-shadow:0 8px 32px rgba(0,0,0,.5);display:flex;align-items:flex-start;gap:10px;max-width:380px;animation:toast-in .3s ease;border:1px solid}
.toast.toast-out{animation:toast-out .25s ease forwards}
.toast-error{background:rgba(255,68,68,.12);border-color:rgba(255,68,68,.2);color:#ff8888}
.toast-success{background:rgba(0,255,136,.1);border-color:rgba(0,255,136,.18);color:#66ffaa}
.toast-warning{background:rgba(255,215,0,.1);border-color:rgba(255,215,0,.18);color:#ffd966}
.toast-info{background:rgba(68,136,255,.1);border-color:rgba(68,136,255,.18);color:#88bbff}
.toast-icon{font-size:18px;flex-shrink:0;line-height:1}
.toast-body{flex:1;min-width:0}
.toast-title{font-family:var(--sans);font-size:13px;font-weight:600;margin-bottom:2px}
.toast-msg{font-size:12px;line-height:1.5;opacity:.85;word-break:break-word}
.toast-close{background:none;border:none;color:inherit;font-size:16px;cursor:pointer;padding:0 0 0 8px;opacity:.5;flex-shrink:0}
.toast-close:hover{opacity:1}
.toast-progress{position:absolute;bottom:0;left:0;height:2px;border-radius:0 0 12px 12px;animation:toast-progress linear forwards}
.toast-error .toast-progress{background:var(--red)}
.toast-success .toast-progress{background:var(--green)}
.toast-warning .toast-progress{background:var(--gold)}
.toast-info .toast-progress{background:var(--blue)}
@keyframes toast-in{from{opacity:0;transform:translateX(40px) scale(.95)}to{opacity:1;transform:translateX(0) scale(1)}}
@keyframes toast-out{from{opacity:1;transform:translateX(0) scale(1)}to{opacity:0;transform:translateX(40px) scale(.9)}}
@keyframes toast-progress{from{width:100%}to{width:0%}}

/* SECTION VISIBILITY */
.page-section{display:none}
.page-section.active{display:block}

/* ‚îÄ‚îÄ TOKEN DETAIL PAGE ‚îÄ‚îÄ */
.detail-page{max-width:1200px;margin:0 auto;padding:20px 24px}
.detail-back{font-family:var(--mono);font-size:13px;color:var(--text-dim);cursor:pointer;display:inline-flex;align-items:center;gap:6px;padding:8px 14px;border-radius:8px;border:1px solid var(--border);background:transparent;transition:all .15s;margin-bottom:20px}
.detail-back:hover{color:var(--text);border-color:var(--border-hover);background:var(--bg3)}
.detail-header{display:flex;align-items:center;gap:16px;margin-bottom:24px;flex-wrap:wrap}
.detail-avatar{width:56px;height:56px;border-radius:14px;display:flex;align-items:center;justify-content:center;font-size:32px}
.detail-title h1{font-family:var(--sans);font-size:28px;font-weight:700;display:flex;align-items:center;gap:10px}
.detail-title .dticker{font-family:var(--mono);font-size:14px;color:var(--text-dim)}
.detail-addr{font-family:var(--mono);font-size:11px;color:var(--text-dim);display:flex;align-items:center;gap:6px;margin-top:4px}
.detail-addr .copy-btn{background:none;border:none;color:var(--text-dim);cursor:pointer;font-size:12px;padding:2px 4px}
.detail-addr .copy-btn:hover{color:var(--gold)}

.detail-body{display:grid;grid-template-columns:1fr 340px;gap:24px}
.detail-left{min-width:0}
.detail-right{}

/* Chart */
.chart-container{background:var(--card);border:1px solid var(--border);border-radius:14px;padding:16px;margin-bottom:20px}
.chart-container h3{font-family:var(--sans);font-size:14px;font-weight:600;margin-bottom:12px;color:var(--text-mid)}
.chart-canvas{width:100%;height:240px;border-radius:8px}

/* Stats grid */
.stats-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-bottom:20px}
.stat-card{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:14px 16px}
.stat-card .stat-label{font-family:var(--mono);font-size:10px;color:var(--text-dim);letter-spacing:.5px;text-transform:uppercase}
.stat-card .stat-val{font-family:var(--mono);font-size:18px;font-weight:700;margin-top:4px}

/* Activity feed */
.activity-feed{background:var(--card);border:1px solid var(--border);border-radius:14px;padding:16px}
.activity-feed h3{font-family:var(--sans);font-size:14px;font-weight:600;margin-bottom:12px;color:var(--text-mid)}
.activity-item{display:flex;align-items:center;gap:10px;padding:10px 0;border-bottom:1px solid var(--border)}
.activity-item:last-child{border-bottom:none}
.activity-type{font-family:var(--mono);font-size:11px;padding:3px 8px;border-radius:5px;font-weight:600}
.activity-type.buy{background:rgba(0,255,136,.1);color:var(--green)}
.activity-type.sell{background:rgba(255,68,68,.1);color:var(--red)}
.activity-wallet{font-family:var(--mono);font-size:11px;color:var(--text-dim);flex:1}
.activity-amount{font-family:var(--mono);font-size:12px;font-weight:600}
.activity-time{font-family:var(--mono);font-size:10px;color:var(--text-dim)}

/* Buy/Sell panel */
.trade-panel{background:var(--card);border:1px solid var(--border);border-radius:14px;padding:20px;position:sticky;top:76px}
.trade-panel h3{font-family:var(--sans);font-size:16px;font-weight:600;margin-bottom:16px}
.trade-tabs{display:flex;gap:4px;margin-bottom:16px}
.trade-tab{flex:1;font-family:var(--mono);font-size:12px;padding:8px;border-radius:8px;border:1px solid var(--border);background:transparent;color:var(--text-dim);cursor:pointer;text-align:center;transition:all .15s}
.trade-tab.active{border-color:var(--gold);color:var(--gold);background:rgba(255,215,0,.05)}
.trade-tab.sell-tab.active{border-color:var(--red);color:var(--red);background:rgba(255,68,68,.05)}
.trade-input-group{margin-bottom:14px}
.trade-input-group label{font-family:var(--mono);font-size:11px;color:var(--text-dim);display:block;margin-bottom:4px}
.trade-input-group input{width:100%;font-family:var(--mono);font-size:14px;padding:10px 14px;border-radius:8px;border:1px solid var(--border);background:var(--bg2);color:var(--text);outline:none}
.trade-input-group input:focus{border-color:var(--gold)}
.trade-submit{width:100%;font-family:var(--sans);font-size:14px;font-weight:600;padding:12px;border-radius:8px;border:none;cursor:pointer;transition:all .15s}
.trade-submit.buy-btn{background:var(--green);color:#000}
.trade-submit.buy-btn:hover{box-shadow:0 0 20px rgba(0,255,136,.25)}
.trade-submit.sell-btn{background:var(--red);color:#fff}
.trade-submit.presale-btn{background:var(--gold);color:#000}
.trade-submit.presale-btn:hover{box-shadow:0 0 20px rgba(255,215,0,.25)}
.trade-info{font-family:var(--mono);font-size:11px;color:var(--text-dim);margin-top:12px;text-align:center}

/* ‚îÄ‚îÄ HOW IT WORKS ‚îÄ‚îÄ */
.hiw-page{max-width:900px;margin:0 auto;padding:40px 24px 80px}
.hiw-hero{text-align:center;margin-bottom:60px}
.hiw-hero h1{font-family:var(--sans);font-size:42px;font-weight:700;background:linear-gradient(135deg,var(--gold),#fff,var(--gold));-webkit-background-clip:text;-webkit-text-fill-color:transparent;margin-bottom:12px}
.hiw-hero p{font-family:var(--inter);font-size:16px;color:var(--text-mid);max-width:600px;margin:0 auto;line-height:1.6}

.hiw-step{background:var(--card);border:1px solid var(--border);border-radius:18px;padding:32px;margin-bottom:24px;position:relative;overflow:hidden}
.hiw-step::before{content:'';position:absolute;top:0;left:0;width:4px;height:100%;background:linear-gradient(180deg,var(--gold),transparent)}
.hiw-step-num{font-family:var(--mono);font-size:48px;font-weight:700;color:rgba(255,215,0,.1);position:absolute;top:12px;right:24px}
.hiw-step h2{font-family:var(--sans);font-size:22px;font-weight:700;margin-bottom:12px;display:flex;align-items:center;gap:10px}
.hiw-step h2 .step-emoji{font-size:28px}
.hiw-step ul{list-style:none;padding:0}
.hiw-step ul li{font-family:var(--inter);font-size:14px;color:var(--text-mid);padding:6px 0;padding-left:20px;position:relative;line-height:1.6}
.hiw-step ul li::before{content:'‚Ä∫';position:absolute;left:0;color:var(--gold);font-weight:700}

.hiw-why{background:linear-gradient(135deg,rgba(255,215,0,.04),rgba(0,255,136,.02));border:1px solid rgba(255,215,0,.15);border-radius:18px;padding:32px;margin:40px 0}
.hiw-why h2{font-family:var(--sans);font-size:24px;font-weight:700;color:var(--gold);margin-bottom:20px;text-align:center}
.hiw-reasons{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:16px}
.hiw-reason{text-align:center;padding:16px}
.hiw-reason .reason-icon{font-size:28px;margin-bottom:8px}
.hiw-reason h3{font-family:var(--sans);font-size:15px;font-weight:600;margin-bottom:4px}
.hiw-reason p{font-family:var(--inter);font-size:13px;color:var(--text-dim);line-height:1.5}

.hiw-compare{margin-top:40px}
.hiw-compare h2{font-family:var(--sans);font-size:22px;font-weight:700;text-align:center;margin-bottom:20px}
.compare-table{width:100%;border-collapse:collapse;background:var(--card);border-radius:14px;overflow:hidden;border:1px solid var(--border)}
.compare-table th{font-family:var(--mono);font-size:12px;padding:14px 18px;text-align:left;background:var(--bg3);color:var(--text-dim);letter-spacing:.5px;text-transform:uppercase}
.compare-table th:last-child{color:var(--gold)}
.compare-table td{font-family:var(--inter);font-size:13px;padding:12px 18px;border-top:1px solid var(--border);color:var(--text-mid)}
.compare-table td:first-child{font-weight:600;color:var(--text)}
.compare-table .good{color:var(--green)}
.compare-table .bad{color:var(--red)}

/* ‚îÄ‚îÄ MY TOKENS (coming soon) ‚îÄ‚îÄ */
.coming-soon{text-align:center;padding:80px 24px}
.coming-soon h2{font-family:var(--sans);font-size:28px;font-weight:700;color:var(--text-dim);margin-bottom:12px}
.coming-soon p{font-family:var(--inter);font-size:14px;color:var(--text-dim)}

/* MODAL */
.modal-overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.8);backdrop-filter:blur(8px);z-index:200;align-items:center;justify-content:center}
.modal-overlay.open{display:flex}
.modal{background:#0a0a0a;border:1px solid var(--border);border-radius:16px;padding:28px;width:90%;max-width:420px;position:relative}
.modal h2{font-family:var(--sans);font-size:20px;font-weight:700;color:var(--gold);margin-bottom:20px}
.modal-close{position:absolute;top:16px;right:16px;background:none;border:none;color:var(--text-dim);font-size:20px;cursor:pointer}
.modal-close:hover{color:var(--text)}
.modal label{font-family:var(--mono);font-size:11px;color:var(--text-dim);letter-spacing:.5px;display:block;margin-bottom:4px;margin-top:14px}
.modal input{width:100%;font-family:var(--mono);font-size:13px;padding:10px 14px;border-radius:8px;border:1px solid var(--border);background:var(--bg2);color:var(--text);outline:none}
.modal input:focus{border-color:var(--gold)}
.modal-submit{width:100%;margin-top:20px;font-family:var(--sans);font-size:14px;font-weight:600;padding:12px;border-radius:8px;border:none;background:var(--gold);color:#000;cursor:pointer;transition:all .15s}
.modal-submit:hover{box-shadow:0 0 20px rgba(255,215,0,.25)}
.modal-submit:disabled{opacity:.5;cursor:not-allowed}
.modal-info{font-family:var(--mono);font-size:11px;color:var(--text-dim);margin-top:12px;text-align:center}

/* RESPONSIVE */
@media(max-width:768px){
  .detail-body{grid-template-columns:1fr}
  .detail-right{position:static}
  .stats-grid{grid-template-columns:repeat(2,1fr)}
}
@media(max-width:640px){
  .grid{grid-template-columns:1fr}
  .topbar{padding:0 16px}
  .grid-container{padding:12px}
  .filters{padding:12px 16px}
  .nav{display:none}
  .hiw-hero h1{font-size:28px}
  .stats-grid{grid-template-columns:1fr 1fr}
  .detail-header h1{font-size:22px}
}
</style>
</head>
<body>

<!-- SIDEBAR -->
<div class="app-layout">
<aside class="sidebar" id="sidebar">
  <div class="sidebar-logo">
    <div class="logo" onclick="navigate('launches')">
      <span style="font-size:22px">‚öñÔ∏è</span>
      <span class="logo-text">SAMES <span class="devnet-badge">DEV</span></span>
    </div>
    <button class="sidebar-toggle" id="sidebarToggle" onclick="toggleSidebar()" title="Toggle sidebar">‚óÄ</button>
  </div>
  <nav class="sidebar-nav">
    <a class="sidebar-link" href="#launches" data-nav="launches" data-tip="Home">
      <span class="link-icon">üè†</span><span class="link-label">Home</span>
    </a>
    <a class="sidebar-link" href="#my-tokens" data-nav="my-tokens" data-tip="Profile" onclick="if(walletPubkey)openProfileModal()">
      <span class="link-icon">üë§</span><span class="link-label">Profile</span>
    </a>
    <a class="sidebar-link" href="#how-it-works" data-nav="how-it-works" data-tip="How It Works">
      <span class="link-icon">üìñ</span><span class="link-label">How It Works</span>
    </a>
  </nav>
  <button class="sidebar-create" id="createBtn" onclick="navigate('create')" data-tip="Create Token">
    <span>üöÄ</span><span class="create-label">Create Token</span>
  </button>
  <div class="sidebar-bottom">
    <button class="sidebar-link" id="walletBtn" style="width:100%" data-tip="Connect Wallet">
      <span class="link-icon">üí≥</span><span class="link-label">Connect Wallet</span>
    </button>
  </div>
</aside>

<!-- MAIN CONTENT -->
<div class="main-content">

<!-- TOP BAR -->
<div class="topbar">
  <div class="topbar-left">
    <input type="text" class="topbar-search" placeholder="Search token..." id="topbarSearch">
  </div>
  <div class="topbar-right">
    <button class="wallet-btn" id="walletBtn2" style="display:none">Connect Wallet</button>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê LAUNCHES PAGE ‚ïê‚ïê‚ïê -->
<div id="page-launches" class="page-section active">
  <!-- LIVE TICKER -->
  <div class="ticker">
    <div class="ticker-item">üü° Active Presales: <span class="ticker-val ticker-gold" id="t-presales">0</span></div>
    <div class="ticker-item">üü¢ Live Trading: <span class="ticker-val ticker-green" id="t-live">0</span></div>
    <div class="ticker-item">üí∞ Total Volume: <span class="ticker-val" id="t-vol">0 SOL</span></div>
    <div class="ticker-item">üë• Unique Buyers: <span class="ticker-val" id="t-buyers">0</span></div>
    <div class="ticker-item">üîí Zero sellers at loss</div>
  </div>

  <!-- FILTERS -->
  <div class="filters">
    <button class="filter-chip active">üî• All</button>
    <button class="filter-chip">üü° Presale</button>
    <button class="filter-chip">üü¢ Live</button>
    <button class="filter-chip">üìà Top Gainers</button>
    <button class="filter-chip">üÜï Newest</button>
    <button class="filter-chip">üí∞ Most Raised</button>
    <input type="text" class="filter-search" placeholder="Search token...">
  </div>

  <!-- TOKEN GRID -->
  <div class="grid-container">
    <div class="grid" id="grid"></div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê TOKEN DETAIL PAGE ‚ïê‚ïê‚ïê -->
<div id="page-token" class="page-section">
  <div class="detail-page" id="detail-content"></div>
</div>

<!-- ‚ïê‚ïê‚ïê HOW IT WORKS PAGE ‚ïê‚ïê‚ïê -->
<div id="page-how-it-works" class="page-section">
  <div class="hiw-page">
    <div class="hiw-hero">
      <h1>‚öñÔ∏è How SAMES Works</h1>
      <p>The fairest token launch on Solana. Three phases take your token from <strong style="color:var(--gold)">fair presale</strong> ‚Üí <strong style="color:var(--green)">protected trading</strong> ‚Üí <strong style="color:var(--blue)">full DEX liquidity</strong>.</p>
    </div>

    <div class="hiw-phases" style="display:flex;gap:8px;justify-content:center;margin:32px 0 40px;flex-wrap:wrap">
      <div style="flex:1;min-width:160px;text-align:center;padding:16px 12px;background:rgba(255,215,0,.05);border:1px solid rgba(255,215,0,.15);border-radius:12px">
        <div style="font-size:28px;margin-bottom:6px">‚è±Ô∏è</div>
        <div style="font-family:var(--mono);font-size:11px;color:var(--gold);letter-spacing:1px">PHASE 1</div>
        <div style="font-family:var(--sans);font-size:14px;font-weight:600;margin-top:4px">Fair Presale</div>
        <div style="font-family:var(--mono);font-size:10px;color:var(--text-dim);margin-top:4px">30 seconds</div>
      </div>
      <div style="display:flex;align-items:center;color:var(--text-dim);font-size:20px">‚Üí</div>
      <div style="flex:1;min-width:160px;text-align:center;padding:16px 12px;background:rgba(0,255,136,.05);border:1px solid rgba(0,255,136,.15);border-radius:12px">
        <div style="font-size:28px;margin-bottom:6px">üõ°Ô∏è</div>
        <div style="font-family:var(--mono);font-size:11px;color:var(--green);letter-spacing:1px">PHASE 2</div>
        <div style="font-family:var(--sans);font-size:14px;font-weight:600;margin-top:4px">Protected Trading</div>
        <div style="font-family:var(--mono);font-size:10px;color:var(--text-dim);margin-top:4px">Bonding curve</div>
      </div>
      <div style="display:flex;align-items:center;color:var(--text-dim);font-size:20px">‚Üí</div>
      <div style="flex:1;min-width:160px;text-align:center;padding:16px 12px;background:rgba(68,136,255,.05);border:1px solid rgba(68,136,255,.15);border-radius:12px">
        <div style="font-size:28px;margin-bottom:6px">üåä</div>
        <div style="font-family:var(--mono);font-size:11px;color:var(--blue);letter-spacing:1px">PHASE 3</div>
        <div style="font-family:var(--sans);font-size:14px;font-weight:600;margin-top:4px">Graduation</div>
        <div style="font-family:var(--mono);font-size:10px;color:var(--text-dim);margin-top:4px">Raydium LP</div>
      </div>
    </div>

    <div class="hiw-step">
      <div class="hiw-step-num" style="color:var(--gold)">01</div>
      <h2><span class="step-emoji">‚è±Ô∏è</span> Phase 1 ‚Äî Fair Presale <span style="font-size:14px;color:var(--gold);font-weight:400">(30 seconds)</span></h2>
      <ul>
        <li>Creator sets token name and symbol ‚Äî fixed <strong style="color:var(--gold)">1 billion</strong> supply, launch goes live instantly</li>
        <li>A <strong style="color:var(--gold)">30-second presale window</strong> opens</li>
        <li>Anyone can deposit SOL during this window</li>
        <li><strong style="color:var(--green)">Everyone gets the SAME price</strong> ‚Äî no advantage to being first</li>
        <li>No bots, no snipers, no front-running. The playing field is 100% level</li>
        <li>When the window closes, tokens are distributed <strong>proportionally</strong>:<br>
          <code style="color:var(--gold);font-size:12px;margin-top:4px;display:inline-block">your tokens = (your SOL √∑ total SOL raised) √ó total supply</code></li>
        <li>More SOL raised = higher starting market cap</li>
        <li>All token addresses end in <code style="color:var(--gold)">"...same"</code> ‚Äî vanity addresses, instantly recognizable</li>
      </ul>
    </div>

    <div class="hiw-step">
      <div class="hiw-step-num" style="color:var(--green)">02</div>
      <h2><span class="step-emoji">üõ°Ô∏è</span> Phase 2 ‚Äî Protected Trading <span style="font-size:14px;color:var(--green);font-weight:400">(Bonding Curve)</span></h2>
      <ul>
        <li>After presale, the token enters a <strong style="color:var(--green)">bonding curve market</strong> on SAMES</li>
        <li>Price moves up and down based on buys/sells, like pump.fun</li>
        <li>BUT with one critical difference: <strong style="color:var(--gold)">you cannot sell below your entry price</strong></li>
        <li>This is enforced <strong>on-chain</strong> via Token-2022 transfer hooks ‚Äî no trust required</li>
        <li>The smart contract tracks every buyer's entry price and blocks sells below it</li>
      </ul>
      <div style="margin:20px 0;padding:20px;background:rgba(255,215,0,.04);border:1px solid rgba(255,215,0,.1);border-radius:10px">
        <div style="font-family:var(--sans);font-size:15px;font-weight:600;color:var(--gold);margin-bottom:10px">üîí Why Price Floor Matters</div>
        <div style="font-family:var(--inter);font-size:13px;color:var(--text-mid);line-height:1.7">
          On pump.fun, devs and early snipers regularly dump on later buyers, crashing the token to zero. On SAMES, <strong style="color:var(--text)">nobody can sell at a loss</strong> during the bonding curve phase. This means:
          <ul style="margin-top:8px;padding-left:20px">
            <li style="margin:4px 0"><strong style="color:var(--green)">No rug pulls</strong> ‚Äî dumpers can't crash below their buy-in</li>
            <li style="margin:4px 0"><strong style="color:var(--green)">Organic growth</strong> ‚Äî only profitable sells go through</li>
            <li style="margin:4px 0"><strong style="color:var(--green)">Confidence</strong> ‚Äî buyers know the floor holds</li>
          </ul>
        </div>
      </div>
    </div>

    <div class="hiw-step">
      <div class="hiw-step-num" style="color:var(--blue)">03</div>
      <h2><span class="step-emoji">üåä</span> Phase 3 ‚Äî Graduation to Raydium <span style="font-size:14px;color:var(--blue);font-weight:400">(Full DEX)</span></h2>
      <ul>
        <li>When the bonding curve hits the <strong style="color:var(--gold)">graduation threshold</strong> (market cap target), the token graduates</li>
        <li>Liquidity is <strong>automatically migrated</strong> to a Raydium LP pool</li>
        <li>Price floor is removed ‚Äî the token becomes a <strong>normal, freely tradeable token</strong></li>
        <li>No more restrictions, no more training wheels ‚Äî full degen mode üöÄ</li>
        <li>The token now lives on Raydium like any other Solana token</li>
      </ul>
      <div style="margin:20px 0;padding:20px;background:rgba(68,136,255,.04);border:1px solid rgba(68,136,255,.1);border-radius:10px">
        <div style="font-family:var(--sans);font-size:15px;font-weight:600;color:var(--blue);margin-bottom:10px">üí° Why Graduate?</div>
        <div style="font-family:var(--inter);font-size:13px;color:var(--text-mid);line-height:1.7">
          The bonding curve phase is <strong style="color:var(--text)">training wheels</strong>. It protects the token while it's young and vulnerable. Once it has enough liquidity and community support, it graduates to a real DEX where it can reach its full potential. Think of it as a launchpad ‚Üí orbit transfer.
        </div>
      </div>
    </div>

    <div class="hiw-why">
      <h2>‚öñÔ∏è Why SAMES?</h2>
      <div class="hiw-reasons">
        <div class="hiw-reason">
          <div class="reason-icon">ü§ù</div>
          <h3>Fair</h3>
          <p>Everyone gets the same price. Period. No snipers, no bots.</p>
        </div>
        <div class="hiw-reason">
          <div class="reason-icon">üõ°Ô∏è</div>
          <h3>Protected</h3>
          <p>Can't sell below entry during bonding curve. No dumps, no rugs.</p>
        </div>
        <div class="hiw-reason">
          <div class="reason-icon">üìà</div>
          <h3>Growth Path</h3>
          <p>Presale ‚Üí Bonding Curve ‚Üí Raydium. Clear graduation path.</p>
        </div>
        <div class="hiw-reason">
          <div class="reason-icon">‚õìÔ∏è</div>
          <h3>On-Chain</h3>
          <p>Transfer hooks enforce everything. No trust needed.</p>
        </div>
        <div class="hiw-reason">
          <div class="reason-icon">‚ö°</div>
          <h3>Fast</h3>
          <p>30 seconds from creation to tradeable token.</p>
        </div>
      </div>
    </div>

    <div class="hiw-compare">
      <h2>SAMES vs pump.fun</h2>
      <table class="compare-table">
        <thead>
          <tr><th>Feature</th><th>pump.fun</th><th>SAMES</th></tr>
        </thead>
        <tbody>
          <tr><td>Launch pricing</td><td class="bad">Bonding curve (first = cheapest)</td><td class="good">Same price for all (30s window)</td></tr>
          <tr><td>Bot/sniper advantage</td><td class="bad">‚úÖ Huge</td><td class="good">‚ùå None</td></tr>
          <tr><td>Sell below entry</td><td class="bad">‚úÖ Allowed (dumps)</td><td class="good">‚ùå Blocked on-chain</td></tr>
          <tr><td>Rug pull protection</td><td class="bad">‚ùå None</td><td class="good">‚úÖ Price floor enforced</td></tr>
          <tr><td>DEX graduation</td><td>Raydium</td><td class="good">Raydium (same)</td></tr>
          <tr><td>On-chain enforcement</td><td class="bad">‚ùå No</td><td class="good">‚úÖ Token-2022 hooks</td></tr>
          <tr><td>Vanity addresses</td><td>...pump</td><td class="good">...same</td></tr>
        </tbody>
      </table>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê MY TOKENS PAGE ‚ïê‚ïê‚ïê -->
<div id="page-my-tokens" class="page-section">
  <div class="coming-soon">
    <h2>üîí My Tokens</h2>
    <p>Portfolio tracking coming soon. Connect your wallet to see your SAMES positions.</p>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê CREATE TOKEN PAGE ‚ïê‚ïê‚ïê -->
<div id="page-create" class="page-section">
  <div class="create-page">
    <h1>Create new token</h1>
    <p class="subtitle">Choose carefully, these can't be changed once the token is created.</p>
    
    <div class="create-layout">
      <div class="create-form">
        <!-- Coin Details -->
        <div class="form-section">
          <h3>Token details</h3>
          <div class="form-row">
            <div class="form-group">
              <label>Token Name</label>
              <input type="text" id="lm-name" placeholder="Name your token" maxlength="32" oninput="updatePreview()">
              <div class="char-count"><span id="name-count">0</span>/32</div>
            </div>
            <div class="form-group">
              <label>Ticker</label>
              <input type="text" id="lm-symbol" placeholder="e.g. DOGE" maxlength="10" oninput="updatePreview()" style="text-transform:uppercase">
              <div class="char-count"><span id="symbol-count">0</span>/10</div>
            </div>
          </div>
          <div class="form-group">
            <label>Description <span style="color:var(--text-dim)">(Optional)</span></label>
            <textarea id="lm-desc" placeholder="Write a short description" maxlength="256" oninput="updatePreview()"></textarea>
            <div class="char-count"><span id="desc-count">0</span>/256</div>
          </div>

          <!-- Social Links -->
          <button class="social-toggle" onclick="toggleSocials()">üîó Add social links (Optional) ‚ñæ</button>
          <div class="social-fields" id="socialFields">
            <div class="form-group">
              <label>üåê Website</label>
              <input type="url" id="lm-website" placeholder="https://yourtoken.com" oninput="updatePreview()">
            </div>
            <div class="form-group">
              <label>‚úàÔ∏è Telegram</label>
              <input type="url" id="lm-telegram" placeholder="https://t.me/yourgroup" oninput="updatePreview()">
            </div>
            <div class="form-group">
              <label>ùïè Twitter</label>
              <input type="url" id="lm-twitter" placeholder="https://x.com/yourtoken" oninput="updatePreview()">
            </div>
          </div>
        </div>

        <!-- Image Upload -->
        <div class="form-section">
          <h3>Token image</h3>
          <div class="image-upload" id="imageUpload" onclick="document.getElementById('imageInput').click()">
            <div id="uploadPlaceholder">
              <div class="upload-icon">üñºÔ∏è</div>
              <div class="upload-text">Select image to upload</div>
              <div class="upload-hint">or drag and drop it here</div>
            </div>
            <img id="imagePreviewSrc" style="display:none">
            <input type="file" id="imageInput" accept="image/png,image/jpeg,image/gif,image/webp" onchange="handleImageUpload(event)">
          </div>
          <div class="file-specs">
            <div class="file-spec">
              <span class="spec-icon">üìÑ</span>
              <div>
                <div class="spec-title">File size and type</div>
                <div class="spec-list">Image ‚Äî max 5MB<br>.jpg, .png, .gif or .webp</div>
              </div>
            </div>
            <div class="file-spec">
              <span class="spec-icon">üìê</span>
              <div>
                <div class="spec-title">Resolution</div>
                <div class="spec-list">Min 500√ó500px<br>1:1 square recommended</div>
              </div>
            </div>
          </div>
        </div>

        <!-- Fixed params info -->
        <div class="form-note">
          <span class="note-icon">‚ÑπÔ∏è</span>
          Token data (image, social links) can only be set at creation and can't be changed after.
        </div>

        <button class="create-submit" id="lm-submit" onclick="submitLaunch()">Create Token</button>
      </div>

      <!-- Live Preview -->
      <div class="create-preview">
        <div class="preview-card">
          <div class="preview-label">Preview</div>
          <div class="preview-image" id="previewImage">
            A preview of how the token will look
          </div>
          <div class="preview-info">
            <div class="preview-name" id="previewName">Token Name</div>
            <div class="preview-ticker" id="previewTicker">$TICKER</div>
            <div class="preview-desc" id="previewDesc" style="display:none"></div>
            <div class="preview-links" id="previewLinks"></div>
          </div>
          <div class="preview-stats">
            <div class="preview-stat"><div class="ps-label">Supply</div><div class="ps-val">1B</div></div>
            <div class="preview-stat"><div class="ps-label">Presale</div><div class="ps-val">30s</div></div>
            <div class="preview-stat"><div class="ps-label">Graduation</div><div class="ps-val">69 SOL</div></div>
            <div class="preview-stat"><div class="ps-label">Price Floor</div><div class="ps-val">‚úÖ</div></div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- BUY MODAL -->
<div class="modal-overlay" id="buyModal">
  <div class="modal">
    <button class="modal-close" onclick="closeBuyModal()">&times;</button>
    <h2>üí∞ Buy Presale</h2>
    <div id="buy-token-info" style="font-family:var(--mono);font-size:12px;color:var(--text-mid);margin-bottom:10px"></div>
    <label>SOL Amount</label>
    <input type="number" id="bm-amount" placeholder="e.g. 1.5" step="0.01" min="0.001">
    <button class="modal-submit" id="bm-submit" onclick="submitBuy()">Buy</button>
    <div class="modal-info">Funds go to the presale vault. Tokens distributed after launch.</div>
  </div>
</div>

</div><!-- /main-content -->
</div><!-- /app-layout -->

<!-- PROFILE MODAL -->
<div class="profile-modal" id="profileModal" onclick="if(event.target===this)closeProfileModal()">
  <div class="profile-modal-inner">
    <h2>üë§ Set Up Profile</h2>
    <div class="pfp-upload-area" id="pfpUploadArea" onclick="document.getElementById('pfpInput').click()">
      <span id="pfpPreviewEmoji">üë§</span>
      <img id="pfpPreviewImg" style="display:none">
      <input type="file" id="pfpInput" accept="image/*" style="display:none" onchange="handlePfpUpload(event)">
    </div>
    <div style="text-align:center;font-family:var(--mono);font-size:10px;color:var(--text-dim);margin-bottom:16px">Click to upload profile picture</div>
    <div class="form-group">
      <label>Username</label>
      <input type="text" id="profileUsername" placeholder="Enter username" maxlength="32">
    </div>
    <div class="form-group" style="margin-top:12px">
      <label>Bio <span style="color:var(--text-dim)">(optional)</span></label>
      <input type="text" id="profileBio" placeholder="Short bio" maxlength="160">
    </div>
    <button class="create-submit" style="margin-top:20px" onclick="saveProfile()">Save Profile</button>
  </div>
</div>

<!-- Toast container -->
<div class="toast-container" id="toastContainer"></div>

<script src="https://unpkg.com/@solana/web3.js@latest/lib/index.iife.min.js"></script>
<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// SAMES ‚Äî Real On-Chain App (No Mock Data)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const { Connection, PublicKey, Transaction, TransactionInstruction, SystemProgram, LAMPORTS_PER_SOL } = solanaWeb3;
const PROGRAM_ID = new PublicKey('H91AKWdUASAKjpGwq4NXzp8kyddLbZMj9N1rP8HFjCmw');
const connection = new Connection('https://api.devnet.solana.com', 'confirmed');

const API_URL = 'http://65.20.103.177:3001';
let walletPubkey = null;
let onchainLaunches = [];
let selectedLaunch = null;
let userProfile = null;
let chatPollInterval = null;

// ‚îÄ‚îÄ Toast System ‚îÄ‚îÄ
const TOAST_ICONS = { error:'‚ùå', success:'‚úÖ', warning:'‚ö†Ô∏è', info:'‚ÑπÔ∏è' };
const TOAST_TITLES = { error:'Error', success:'Success', warning:'Warning', info:'Info' };

function toast(msg, type='info', duration=5000) {
  const container = document.getElementById('toastContainer');
  const el = document.createElement('div');
  el.className = `toast toast-${type}`;
  el.style.position = 'relative';
  el.innerHTML = `
    <span class="toast-icon">${TOAST_ICONS[type]}</span>
    <div class="toast-body">
      <div class="toast-title">${TOAST_TITLES[type]}</div>
      <div class="toast-msg">${msg}</div>
    </div>
    <button class="toast-close" onclick="dismissToast(this.parentElement)">&times;</button>
    <div class="toast-progress" style="animation-duration:${duration}ms"></div>`;
  container.appendChild(el);
  setTimeout(() => dismissToast(el), duration);
}
function dismissToast(el) {
  if (!el || el.classList.contains('toast-out')) return;
  el.classList.add('toast-out');
  setTimeout(() => el.remove(), 250);
}

// Status enum mapping (matches Rust enum order)
const STATUS_PRESALE = 0;
const STATUS_BONDING_CURVE = 1;
const STATUS_GRADUATED = 2;
const STATUS_CLOSED = 3;
const statusNames = ['presale', 'bonding', 'graduated', 'closed'];
const statusLabels = ['‚óè PRESALE', '‚óè BONDING CURVE', 'üéì GRADUATED', '‚óè CLOSED'];
const statusClasses = ['status-presale', 'status-live', 'status-live', 'status-ended'];

// ‚îÄ‚îÄ Navigation / Routing ‚îÄ‚îÄ
function navigate(page, param) {
  if (page === 'launches') window.location.hash = '#launches';
  else if (page === 'how-it-works') window.location.hash = '#how-it-works';
  else if (page === 'my-tokens') window.location.hash = '#my-tokens';
  else if (page === 'create') window.location.hash = '#create';
  else if (page === 'token') window.location.hash = '#token/' + param;
}

function handleRoute() {
  const hash = window.location.hash || '#launches';
  document.querySelectorAll('.page-section').forEach(s => s.classList.remove('active'));
  document.querySelectorAll('.nav a,.sidebar-link').forEach(a => a.classList.remove('active'));

  if (hash.startsWith('#token/')) {
    document.getElementById('page-token').classList.add('active');
    const id = hash.slice(7);
    renderTokenDetail(id);
  } else if (hash === '#create') {
    document.getElementById('page-create').classList.add('active');
  } else if (hash === '#how-it-works') {
    document.getElementById('page-how-it-works').classList.add('active');
    document.querySelectorAll('[data-nav="how-it-works"]').forEach(a => a.classList.add('active'));
  } else if (hash === '#my-tokens') {
    document.getElementById('page-my-tokens').classList.add('active');
    document.querySelectorAll('[data-nav="my-tokens"]').forEach(a => a.classList.add('active'));
  } else {
    document.getElementById('page-launches').classList.add('active');
    document.querySelectorAll('[data-nav="launches"]').forEach(a => a.classList.add('active'));
  }
}
window.addEventListener('hashchange', handleRoute);

// ‚îÄ‚îÄ Wallet ‚îÄ‚îÄ
async function getProvider() {
  if (window.solana?.isPhantom) return window.solana;
  if (window.solflare?.isSolflare) return window.solflare;
  throw new Error('No Solana wallet found. Install Phantom or Solflare.');
}

async function connectWallet() {
  try {
    const provider = await getProvider();
    const resp = await provider.connect();
    walletPubkey = resp.publicKey;
    const short = walletPubkey.toBase58().slice(0,4) + '...' + walletPubkey.toBase58().slice(-4);
    // Update sidebar wallet button
    const btn = document.getElementById('walletBtn');
    btn.querySelector('.link-label').textContent = short;
    btn.setAttribute('data-tip', short);
    btn.style.color = 'var(--green)';
    toast('Wallet connected: ' + short, 'success');
    loadProfile();
  } catch(e) {
    console.error(e);
    toast('Wallet connection failed: ' + (e.message || e), 'error');
  }
}
document.getElementById('walletBtn').addEventListener('click', connectWallet);

// ‚îÄ‚îÄ Helpers ‚îÄ‚îÄ
function hashCode(s) { let h=0; for(let i=0;i<s.length;i++) h=((h<<5)-h)+s.charCodeAt(i)|0; return h; }
function findPDA(seeds) { return PublicKey.findProgramAddressSync(seeds, PROGRAM_ID); }
async function getDiscriminator(name) {
  const d = new TextEncoder().encode('global:' + name);
  const h = await crypto.subtle.digest('SHA-256', d);
  return new Uint8Array(h).slice(0, 8);
}
function encodeString(s) {
  const encoded = new TextEncoder().encode(s);
  const buf = new Uint8Array(4 + encoded.length);
  new DataView(buf.buffer).setUint32(0, encoded.length, true);
  buf.set(encoded, 4);
  return buf;
}
function encodeU64(n) {
  const buf = new ArrayBuffer(8);
  new DataView(buf).setBigUint64(0, BigInt(n), true);
  return new Uint8Array(buf);
}
function formatSOL(lamports) {
  const sol = lamports / LAMPORTS_PER_SOL;
  if (sol >= 1000) return sol.toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g, ',');
  if (sol >= 1) return sol.toFixed(2);
  return sol.toFixed(4);
}
function shortAddr(addr) { return addr.slice(0,4) + '...' + addr.slice(-4); }
function timeAgo(timestamp) {
  const diff = Math.floor(Date.now()/1000) - timestamp;
  if (diff < 60) return diff + 's ago';
  if (diff < 3600) return Math.floor(diff/60) + 'm ago';
  if (diff < 86400) return Math.floor(diff/3600) + 'h ago';
  return Math.floor(diff/86400) + 'd ago';
}

// ‚îÄ‚îÄ Sidebar Toggle ‚îÄ‚îÄ
function toggleSidebar() {
  const sb = document.getElementById('sidebar');
  const btn = document.getElementById('sidebarToggle');
  const collapsed = sb.classList.toggle('collapsed');
  document.body.classList.toggle('sb-collapsed', collapsed);
  btn.textContent = collapsed ? '‚ñ∂' : '‚óÄ';
  localStorage.setItem('sidebar-collapsed', collapsed);
}
// Restore sidebar state
if (localStorage.getItem('sidebar-collapsed') === 'true') {
  document.getElementById('sidebar').classList.add('collapsed');
  document.body.classList.add('sb-collapsed');
  document.getElementById('sidebarToggle').textContent = '‚ñ∂';
}

// ‚îÄ‚îÄ Create Launch ‚îÄ‚îÄ (sidebar button already has onclick="navigate('create')")

function toggleSocials() {
  document.getElementById('socialFields').classList.toggle('open');
}

let uploadedImageData = null;
function handleImageUpload(e) {
  const file = e.target.files[0];
  if (!file) return;
  if (file.size > 5 * 1024 * 1024) { toast('Image must be under 5MB', 'warning'); return; }
  const reader = new FileReader();
  reader.onload = (ev) => {
    uploadedImageData = ev.target.result;
    const img = document.getElementById('imagePreviewSrc');
    img.src = uploadedImageData;
    img.style.display = 'block';
    document.getElementById('uploadPlaceholder').style.display = 'none';
    document.getElementById('imageUpload').classList.add('has-image');
    updatePreview();
  };
  reader.readAsDataURL(file);
}

function updatePreview() {
  const name = document.getElementById('lm-name').value || 'Token Name';
  const symbol = document.getElementById('lm-symbol').value || 'TICKER';
  const desc = document.getElementById('lm-desc').value;
  document.getElementById('previewName').textContent = name;
  document.getElementById('previewTicker').textContent = '$' + symbol.toUpperCase();
  document.getElementById('name-count').textContent = document.getElementById('lm-name').value.length;
  document.getElementById('symbol-count').textContent = document.getElementById('lm-symbol').value.length;
  document.getElementById('desc-count').textContent = (desc || '').length;

  const descEl = document.getElementById('previewDesc');
  if (desc) { descEl.textContent = desc; descEl.style.display = 'block'; }
  else { descEl.style.display = 'none'; }

  if (uploadedImageData) {
    document.getElementById('previewImage').innerHTML = `<img src="${uploadedImageData}">`;
  }

  // Social links preview
  const links = [];
  const website = document.getElementById('lm-website')?.value;
  const telegram = document.getElementById('lm-telegram')?.value;
  const twitter = document.getElementById('lm-twitter')?.value;
  if (website) links.push('üåê Website');
  if (telegram) links.push('‚úàÔ∏è Telegram');
  if (twitter) links.push('ùïè Twitter');
  const linksEl = document.getElementById('previewLinks');
  linksEl.innerHTML = links.map(l => `<span class="preview-link">${l}</span>`).join('');
}

// Drag & drop support
const uploadArea = document.getElementById('imageUpload');
if (uploadArea) {
  ['dragenter','dragover'].forEach(ev => uploadArea.addEventListener(ev, e => { e.preventDefault(); uploadArea.style.borderColor = 'var(--gold)'; }));
  ['dragleave','drop'].forEach(ev => uploadArea.addEventListener(ev, e => { e.preventDefault(); uploadArea.style.borderColor = ''; }));
  uploadArea.addEventListener('drop', e => {
    const file = e.dataTransfer?.files[0];
    if (file) { document.getElementById('imageInput').files = e.dataTransfer.files; handleImageUpload({target:{files:[file]}}); }
  });
}

async function submitLaunch() {
  const name = document.getElementById('lm-name').value.trim();
  const symbol = document.getElementById('lm-symbol').value.trim();
  if (!name || !symbol) { toast('Please fill in token name and symbol', 'warning'); return; }
  const supply = 1_000_000_000_000_000; // 1B tokens with 6 decimals
  const price = 1000; // 0.000001 SOL per token (starting price, bonding curve will increase)
  const btn = document.getElementById('lm-submit');
  btn.disabled = true; btn.textContent = 'Sending...';
  try {
    const provider = await getProvider();
    const mintKp = solanaWeb3.Keypair.generate();
    const mint = mintKp.publicKey;
    const [launchPool] = findPDA([new TextEncoder().encode('launch_pool'), mint.toBytes()]);
    const [vault] = findPDA([new TextEncoder().encode('vault'), launchPool.toBytes()]);
    const [marketRegistry] = findPDA([new TextEncoder().encode('market_registry'), launchPool.toBytes()]);

    const disc = await getDiscriminator('create_launch');
    const data = new Uint8Array([
      ...disc, ...encodeString(name), ...encodeString(symbol),
      ...encodeU64(supply), ...encodeU64(price),
    ]);

    const ix = new TransactionInstruction({
      keys: [
        { pubkey: walletPubkey, isSigner: true, isWritable: true },
        { pubkey: mint, isSigner: false, isWritable: false },
        { pubkey: launchPool, isSigner: false, isWritable: true },
        { pubkey: vault, isSigner: false, isWritable: true },
        { pubkey: marketRegistry, isSigner: false, isWritable: true },
        { pubkey: SystemProgram.programId, isSigner: false, isWritable: false },
      ],
      programId: PROGRAM_ID,
      data: data,
    });

    const tx = new Transaction().add(ix);
    tx.feePayer = walletPubkey;
    tx.recentBlockhash = (await connection.getLatestBlockhash()).blockhash;

    const signed = await provider.signTransaction(tx);
    const sig = await connection.sendRawTransaction(signed.serialize());
    await connection.confirmTransaction(sig, 'confirmed');
    toast('Token launched! TX: ' + sig.slice(0,16) + '...', 'success', 8000);
    navigate('launches');
    loadOnchainLaunches();
  } catch(e) {
    console.error(e);
    toast((e.message || String(e)).slice(0, 200), 'error', 8000);
  } finally {
    btn.disabled = false; btn.textContent = 'Create Launch';
  }
}

// ‚îÄ‚îÄ Buy Presale ‚îÄ‚îÄ
function openBuyModal(launch) {
  if (!walletPubkey) { toast('Connect your wallet first', 'warning'); return; }
  selectedLaunch = launch;
  const priceSOL = (launch.price_lamports / LAMPORTS_PER_SOL).toFixed(6);
  document.getElementById('buy-token-info').textContent = `${launch.token_name} (${launch.token_symbol}) ‚Äî ${priceSOL} SOL/token`;
  document.getElementById('bm-amount').value = '';
  document.getElementById('buyModal').classList.add('open');
}
function closeBuyModal() { document.getElementById('buyModal').classList.remove('open'); selectedLaunch = null; }

async function submitBuy() {
  if (!selectedLaunch) return;
  const solAmount = parseFloat(document.getElementById('bm-amount').value);
  if (!solAmount || solAmount <= 0) { toast('Enter a valid SOL amount', 'warning'); return; }
  const btn = document.getElementById('bm-submit');
  btn.disabled = true; btn.textContent = 'Sending...';
  try {
    const provider = await getProvider();
    const lamports = Math.round(solAmount * LAMPORTS_PER_SOL);
    const mintKey = new PublicKey(selectedLaunch.mint);
    const [launchPool] = findPDA([new TextEncoder().encode('launch_pool'), mintKey.toBytes()]);
    const [vault] = findPDA([new TextEncoder().encode('vault'), launchPool.toBytes()]);
    const [buyerRecord] = findPDA([new TextEncoder().encode('buyer_record'), launchPool.toBytes(), walletPubkey.toBytes()]);

    // Determine instruction based on phase
    const isPresale = selectedLaunch.status === STATUS_PRESALE;
    const isBondingCurve = selectedLaunch.status === STATUS_BONDING_CURVE;
    
    let disc, ix;
    if (isPresale) {
      disc = await getDiscriminator('buy_presale');
      const data = new Uint8Array([...disc, ...encodeU64(lamports)]);
      ix = new TransactionInstruction({
        keys: [
          { pubkey: walletPubkey, isSigner: true, isWritable: true },
          { pubkey: launchPool, isSigner: false, isWritable: true },
          { pubkey: vault, isSigner: false, isWritable: true },
          { pubkey: buyerRecord, isSigner: false, isWritable: true },
          { pubkey: SystemProgram.programId, isSigner: false, isWritable: false },
        ],
        programId: PROGRAM_ID,
        data: data,
      });
    } else if (isBondingCurve) {
      // Token-2022 program and buyer's token account needed
      const TOKEN_2022 = new PublicKey('TokenzQdBNbLqP5VEhdkAS6EPFLC1PHnBqCXEpPxuEb');
      // For buy_curve, we need the mint and buyer's token account
      disc = await getDiscriminator('buy_curve');
      const data = new Uint8Array([...disc, ...encodeU64(lamports)]);
      // Get or create associated token account for Token-2022
      // Simplified - user needs token account
      ix = new TransactionInstruction({
        keys: [
          { pubkey: walletPubkey, isSigner: true, isWritable: true },
          { pubkey: launchPool, isSigner: false, isWritable: true },
          { pubkey: mintKey, isSigner: false, isWritable: true },
          { pubkey: vault, isSigner: false, isWritable: true },
          { pubkey: buyerRecord, isSigner: false, isWritable: true },
          { pubkey: walletPubkey, isSigner: false, isWritable: true }, // buyer_token_account placeholder
          { pubkey: TOKEN_2022, isSigner: false, isWritable: false },
          { pubkey: SystemProgram.programId, isSigner: false, isWritable: false },
        ],
        programId: PROGRAM_ID,
        data: data,
      });
    } else {
      toast('This token is graduated or closed ‚Äî trade on Raydium', 'info');
      return;
    }

    const tx = new Transaction().add(ix);
    tx.feePayer = walletPubkey;
    tx.recentBlockhash = (await connection.getLatestBlockhash()).blockhash;

    const signed = await provider.signTransaction(tx);
    const sig = await connection.sendRawTransaction(signed.serialize());
    await connection.confirmTransaction(sig, 'confirmed');
    toast('Purchase successful! TX: ' + sig.slice(0,16) + '...', 'success', 8000);
    closeBuyModal();
    loadOnchainLaunches();
  } catch(e) {
    console.error(e);
    toast((e.message || String(e)).slice(0, 200), 'error', 8000);
  } finally {
    btn.disabled = false; btn.textContent = 'Buy';
  }
}

// ‚îÄ‚îÄ Deserialize LaunchPool (matches updated Rust struct) ‚îÄ‚îÄ
function deserializeLaunchPool(data, pubkey) {
  const view = new DataView(data.buffer, data.byteOffset, data.byteLength);
  let offset = 8; // skip discriminator
  const creator = new PublicKey(data.slice(offset, offset+32)); offset += 32;
  const mint = new PublicKey(data.slice(offset, offset+32)); offset += 32;
  const nameLen = view.getUint32(offset, true); offset += 4;
  const token_name = new TextDecoder().decode(data.slice(offset, offset+nameLen)); offset += nameLen;
  const symLen = view.getUint32(offset, true); offset += 4;
  const token_symbol = new TextDecoder().decode(data.slice(offset, offset+symLen)); offset += symLen;
  const total_supply = view.getBigUint64(offset, true); offset += 8;
  const price_lamports = view.getBigUint64(offset, true); offset += 8;
  const slope_scaled = view.getBigUint64(offset, true); offset += 8;
  const tokens_sold_curve = view.getBigUint64(offset, true); offset += 8;
  const curve_sol_collected = view.getBigUint64(offset, true); offset += 8;
  const start_time = view.getBigInt64(offset, true); offset += 8;
  const end_time = view.getBigInt64(offset, true); offset += 8;
  const total_sol_collected = view.getBigUint64(offset, true); offset += 8;
  const buyer_count = view.getUint32(offset, true); offset += 4;
  const graduation_threshold = view.getBigUint64(offset, true); offset += 8;
  const status = data[offset]; offset += 1;

  return {
    address: pubkey.toBase58(),
    creator: creator.toBase58(),
    mint: mint.toBase58(),
    token_name, token_symbol,
    total_supply: Number(total_supply),
    price_lamports: Number(price_lamports),
    slope_scaled: Number(slope_scaled),
    tokens_sold_curve: Number(tokens_sold_curve),
    curve_sol_collected: Number(curve_sol_collected),
    start_time: Number(start_time),
    end_time: Number(end_time),
    total_sol_collected: Number(total_sol_collected),
    buyer_count, status,
    graduation_threshold: Number(graduation_threshold),
  };
}

// ‚îÄ‚îÄ Bonding curve price calculation (mirrors Rust) ‚îÄ‚îÄ
function bondingCurvePrice(basePrice, slopeScaled, tokensSold) {
  return basePrice + Math.floor((slopeScaled * tokensSold) / 1e9);
}

// ‚îÄ‚îÄ Fetch launches from chain ‚îÄ‚îÄ
async function loadOnchainLaunches() {
  try {
    const accounts = await connection.getProgramAccounts(PROGRAM_ID);
    const accountDisc = await (async () => {
      const d = new TextEncoder().encode('account:LaunchPool');
      const h = await crypto.subtle.digest('SHA-256', d);
      return new Uint8Array(h).slice(0,8);
    })();

    const launches = [];
    for (const { pubkey, account } of accounts) {
      const data = account.data;
      if (data.length < 100) continue;
      const match = accountDisc.every((b, i) => data[i] === b);
      if (!match) continue;
      try {
        launches.push(deserializeLaunchPool(data, pubkey));
      } catch(e) { console.warn('Failed to deserialize', pubkey.toBase58(), e); }
    }
    // Sort: presales first, then bonding curve, then graduated, then closed. Within: newest first
    launches.sort((a, b) => {
      if (a.status !== b.status) return a.status - b.status;
      return b.start_time - a.start_time;
    });
    onchainLaunches = launches;
    renderAll();
  } catch(e) {
    console.error('Failed to load launches:', e);
    renderAll();
  }
}

// ‚îÄ‚îÄ Render ‚îÄ‚îÄ
const emojis = ['ü™ô','üî∂','üí†','üü°','üîµ','üü£','üî¥','üü¢','‚≠ê','üíé','üåÄ','üéØ'];
const bgColors = ['#2a1800','#002a00','#1a0028','#000a1a','#001a2a','#1a1000','#0a0a1a','#001a1a','#180018','#1a0000','#000820','#0a1800'];

function renderCard(l) {
  const st = l.status;
  const isPresale = st === STATUS_PRESALE;
  const isBonding = st === STATUS_BONDING_CURVE;
  const isGraduated = st === STATUS_GRADUATED;
  const emoji = emojis[Math.abs(hashCode(l.token_name)) % emojis.length];
  const bg = bgColors[Math.abs(hashCode(l.token_name)) % bgColors.length];
  const cardClass = isPresale ? 'presale' : (isBonding ? 'live' : '');
  
  const now = Math.floor(Date.now()/1000);
  const remaining = l.end_time - now;
  const totalDuration = l.end_time - l.start_time;
  const progress = totalDuration > 0 ? Math.min(100, Math.max(0, Math.round(((totalDuration - Math.max(0, remaining)) / totalDuration) * 100))) : 100;
  
  const solCollected = formatSOL(l.total_sol_collected + l.curve_sol_collected);
  const currentPrice = bondingCurvePrice(l.price_lamports, l.slope_scaled, l.tokens_sold_curve);
  const priceSOL = formatSOL(currentPrice);
  const creatorShort = shortAddr(l.creator);
  const mintShort = shortAddr(l.mint);
  
  // Graduation progress for bonding curve
  const gradProgress = l.graduation_threshold > 0 ? Math.min(100, Math.round((l.curve_sol_collected / l.graduation_threshold) * 100)) : 0;

  let countdownHTML;
  if (isPresale) {
    countdownHTML = `
      <div class="card-countdown">
        <div class="countdown-timer" data-endtime="${l.end_time}">--:--</div>
        <div class="countdown-label">presale ends</div>
      </div>`;
  } else if (isBonding) {
    countdownHTML = `
      <div class="card-countdown">
        <div class="countdown-timer" style="color:var(--green);font-size:20px">${gradProgress}% to graduation</div>
        <div class="countdown-label">${formatSOL(l.curve_sol_collected)} / ${formatSOL(l.graduation_threshold)} SOL</div>
      </div>`;
  } else if (isGraduated) {
    countdownHTML = `
      <div class="card-countdown">
        <div class="countdown-timer" style="color:var(--blue);font-size:20px">üéì GRADUATED</div>
        <div class="countdown-label">trading on raydium</div>
      </div>`;
  } else {
    countdownHTML = `
      <div class="card-countdown">
        <div class="countdown-timer" style="color:var(--text-dim);font-size:20px">CLOSED</div>
        <div class="countdown-label"></div>
      </div>`;
  }

  return `
    <div class="card ${cardClass}" onclick="navigate('token','${l.address}')">
      <div class="card-header">
        <div class="token-avatar" style="background:${bg}">${emoji}</div>
        <div class="card-info">
          <h3>${l.token_name}</h3>
          <span class="ticker-name">$${l.token_symbol}</span>
        </div>
        <span class="card-status ${statusClasses[st]}">${statusLabels[st]}</span>
      </div>
      ${countdownHTML}
      <div class="card-progress">
        <div class="progress-bar"><div class="progress-fill" style="width:${isPresale ? progress : isBonding ? gradProgress : 100}%"></div></div>
      </div>
      <div class="card-stats">
        <div class="card-stat"><div class="s-label">Price</div><div class="s-value">${priceSOL}</div></div>
        <div class="card-stat"><div class="s-label">Buyers</div><div class="s-value">${l.buyer_count.toLocaleString()}</div></div>
        <div class="card-stat"><div class="s-label">SOL</div><div class="s-value">${solCollected}</div></div>
      </div>
      <div class="card-footer">
        <span class="creator">${creatorShort}</span>
        ${isBonding ? '<span class="floor-badge">üîí Price Floor Active</span>' : ''}
        <span class="mint-addr">${mintShort}</span>
      </div>
    </div>`;
}

function renderAll() {
  const grid = document.getElementById('grid');
  
  if (onchainLaunches.length === 0) {
    grid.innerHTML = `
      <div style="grid-column:1/-1;text-align:center;padding:80px 24px">
        <div style="font-size:48px;margin-bottom:16px">üöÄ</div>
        <h2 style="font-family:var(--sans);font-size:24px;font-weight:700;color:var(--text-dim);margin-bottom:8px">No Launches Yet</h2>
        <p style="font-family:var(--inter);font-size:14px;color:var(--text-dim);margin-bottom:24px">Be the first to launch a token on SAMES!</p>
        <button class="create-btn" onclick="document.getElementById('createBtn').click()" style="font-size:16px;padding:12px 28px">+ Launch Token</button>
      </div>`;
  } else {
    grid.innerHTML = onchainLaunches.map(l => renderCard(l)).join('');
  }

  // Update ticker stats with real data
  const presaleCount = onchainLaunches.filter(l => l.status === STATUS_PRESALE).length;
  const liveCount = onchainLaunches.filter(l => l.status === STATUS_BONDING_CURVE).length;
  const totalSol = onchainLaunches.reduce((s, l) => s + l.total_sol_collected + l.curve_sol_collected, 0);
  const totalBuyers = onchainLaunches.reduce((s, l) => s + l.buyer_count, 0);
  
  document.getElementById('t-presales').textContent = presaleCount;
  document.getElementById('t-live').textContent = liveCount;
  document.getElementById('t-vol').textContent = formatSOL(totalSol) + ' SOL';
  document.getElementById('t-buyers').textContent = totalBuyers.toLocaleString();
}

// ‚îÄ‚îÄ Token Detail Page ‚îÄ‚îÄ
function renderTokenDetail(id) {
  const container = document.getElementById('detail-content');
  const l = onchainLaunches.find(x => x.address === id);
  
  if (!l) {
    container.innerHTML = `
      <button class="detail-back" onclick="navigate('launches')">‚Üê Back</button>
      <p style="color:var(--text-dim);text-align:center;padding:60px">Token not found. It may not have loaded yet.</p>`;
    return;
  }

  const st = l.status;
  const isPresale = st === STATUS_PRESALE;
  const isBonding = st === STATUS_BONDING_CURVE;
  const isGraduated = st === STATUS_GRADUATED;
  const emoji = emojis[Math.abs(hashCode(l.token_name)) % emojis.length];
  const bg = bgColors[Math.abs(hashCode(l.token_name)) % bgColors.length];
  const currentPrice = bondingCurvePrice(l.price_lamports, l.slope_scaled, l.tokens_sold_curve);
  const priceSOL = formatSOL(currentPrice);
  const marketCap = formatSOL(Math.floor((currentPrice / LAMPORTS_PER_SOL) * l.total_supply * LAMPORTS_PER_SOL));
  const totalRaised = formatSOL(l.total_sol_collected + l.curve_sol_collected);
  const gradProgress = l.graduation_threshold > 0 ? Math.min(100, Math.round((l.curve_sol_collected / l.graduation_threshold) * 100)) : 0;

  const phaseLabel = isPresale ? 'Phase 1: Presale' : isBonding ? 'Phase 2: Bonding Curve' : isGraduated ? 'Phase 3: Graduated' : 'Closed';
  const phaseColor = isPresale ? 'var(--gold)' : isBonding ? 'var(--green)' : isGraduated ? 'var(--blue)' : 'var(--text-dim)';

  let tradePanel;
  if (isPresale) {
    tradePanel = `
      <div class="trade-panel">
        <h3>üí∞ Buy Presale</h3>
        <div style="font-family:var(--mono);font-size:12px;color:var(--gold);text-align:center;padding:12px;background:rgba(255,215,0,.05);border-radius:8px;margin-bottom:16px">
          ‚è±Ô∏è Presale ends: <span data-endtime="${l.end_time}" style="font-weight:700">--:--</span>
        </div>
        <div class="trade-input-group">
          <label>SOL Amount</label>
          <input type="number" id="detail-trade-amount" placeholder="0.00" step="0.01" min="0.001">
        </div>
        <button class="trade-submit presale-btn" onclick="detailTrade('${id}')">Buy Presale</button>
        <div class="trade-info">Everyone gets the same price. Tokens distributed after presale ends.</div>
      </div>`;
  } else if (isBonding) {
    tradePanel = `
      <div class="trade-panel">
        <h3>üìä Trade on Bonding Curve</h3>
        <div style="font-family:var(--mono);font-size:11px;text-align:center;padding:10px;background:rgba(0,255,136,.05);border-radius:8px;margin-bottom:12px;color:var(--green)">
          üîí Price floor active ‚Äî can't sell below entry
        </div>
        <div style="font-family:var(--mono);font-size:11px;text-align:center;padding:8px;background:rgba(68,136,255,.05);border-radius:8px;margin-bottom:16px;color:var(--blue)">
          üéì Graduation: ${gradProgress}% (${formatSOL(l.curve_sol_collected)} / ${formatSOL(l.graduation_threshold)} SOL)
        </div>
        <div class="trade-tabs">
          <button class="trade-tab active" onclick="switchTradeTab(this,'buy')">Buy</button>
          <button class="trade-tab sell-tab" onclick="switchTradeTab(this,'sell')">Sell</button>
        </div>
        <div class="trade-input-group">
          <label>SOL Amount</label>
          <input type="number" id="detail-trade-amount" placeholder="0.00" step="0.01" min="0.001">
        </div>
        <button class="trade-submit buy-btn" id="detail-trade-btn" onclick="detailTrade('${id}')">Buy</button>
        <div class="trade-info">1% platform fee on sells. Price moves with the bonding curve.</div>
      </div>`;
  } else if (isGraduated) {
    tradePanel = `
      <div class="trade-panel">
        <h3>üéì Graduated to Raydium</h3>
        <div style="text-align:center;padding:24px;color:var(--text-dim);font-family:var(--inter);font-size:14px;line-height:1.6">
          This token has graduated! Price floor removed.<br>Trade freely on Raydium.
        </div>
        <a href="#" class="trade-submit buy-btn" style="display:block;text-align:center;text-decoration:none;background:var(--blue)">Trade on Raydium ‚Üí</a>
      </div>`;
  } else {
    tradePanel = `<div class="trade-panel"><h3>Closed</h3><p style="color:var(--text-dim);padding:24px;text-align:center">This launch has been closed.</p></div>`;
  }

  container.innerHTML = `
    <button class="detail-back" onclick="navigate('launches')">‚Üê Back to Launches</button>
    <div class="detail-header">
      <div class="detail-avatar" style="background:${bg}">${emoji}</div>
      <div class="detail-title">
        <h1>${l.token_name} <span class="card-status ${statusClasses[st]}">${statusLabels[st]}</span></h1>
        <span class="dticker">$${l.token_symbol}</span>
        <div class="detail-addr">
          <span>${l.mint}</span>
          <button class="copy-btn" onclick="navigator.clipboard.writeText('${l.mint}');this.textContent='‚úì';setTimeout(()=>this.textContent='üìã',1000)">üìã</button>
          <span style="margin-left:8px;color:var(--text-dim)">by ${shortAddr(l.creator)}</span>
          <span style="margin-left:8px;color:${phaseColor};font-weight:600">${phaseLabel}</span>
        </div>
      </div>
    </div>
    <div class="detail-body">
      <div class="detail-left">
        <div class="chart-container">
          <h3>Price Chart</h3>
          <canvas id="priceChart" class="chart-canvas"></canvas>
        </div>
        <div class="stats-grid">
          <div class="stat-card"><div class="stat-label">Current Price</div><div class="stat-val" style="color:${phaseColor}">${priceSOL} SOL</div></div>
          <div class="stat-card"><div class="stat-label">Market Cap</div><div class="stat-val">${marketCap} SOL</div></div>
          <div class="stat-card"><div class="stat-label">Total Raised</div><div class="stat-val">${totalRaised} SOL</div></div>
          <div class="stat-card"><div class="stat-label">Buyers</div><div class="stat-val">${l.buyer_count.toLocaleString()}</div></div>
          <div class="stat-card"><div class="stat-label">${isBonding ? 'Graduation' : 'Phase'}</div><div class="stat-val" style="color:${phaseColor}">${isBonding ? gradProgress + '%' : statusNames[st]}</div></div>
          <div class="stat-card"><div class="stat-label">${isBonding ? 'Floor Price' : 'Base Price'}</div><div class="stat-val" style="color:var(--gold)">${formatSOL(l.price_lamports)} SOL</div></div>
        </div>
        <div class="activity-feed">
          <h3>Recent Activity</h3>
          <div id="activity-list">
            <p style="color:var(--text-dim);text-align:center;padding:24px;font-family:var(--mono);font-size:12px">
              Activity tracking coming soon. Check <a href="https://explorer.solana.com/address/${l.address}?cluster=devnet" target="_blank" style="color:var(--gold)">Solana Explorer</a> for transactions.
            </p>
          </div>
        </div>
        ${getChatHTML(l.address)}
      </div>
      <div class="detail-right">
        ${tradePanel}
      </div>
    </div>`;

  // Load chat
  setTimeout(() => loadChat(l.address), 100);
  // Poll chat every 10s
  if (chatPollInterval) clearInterval(chatPollInterval);
  chatPollInterval = setInterval(() => loadChat(l.address), 10000);

  // Draw bonding curve chart
  setTimeout(() => drawBondingCurveChart(l), 50);
}

function switchTradeTab(el, mode) {
  el.parentElement.querySelectorAll('.trade-tab').forEach(t => t.classList.remove('active'));
  el.classList.add('active');
  const btn = document.getElementById('detail-trade-btn');
  if (mode === 'sell') {
    btn.className = 'trade-submit sell-btn';
    btn.textContent = 'Sell';
  } else {
    btn.className = 'trade-submit buy-btn';
    btn.textContent = 'Buy';
  }
}

function detailTrade(id) {
  if (!walletPubkey) { toast('Connect your wallet first', 'warning'); return; }
  const l = onchainLaunches.find(x => x.address === id);
  if (!l) return;
  openBuyModal(l);
}

// ‚îÄ‚îÄ Bonding Curve Chart ‚îÄ‚îÄ
function drawBondingCurveChart(l) {
  const canvas = document.getElementById('priceChart');
  if (!canvas) return;
  const ctx = canvas.getContext('2d');
  const rect = canvas.parentElement.getBoundingClientRect();
  canvas.width = rect.width - 32;
  canvas.height = 240;
  const w = canvas.width, h = canvas.height;
  const pad = { top: 20, right: 70, bottom: 30, left: 10 };

  const isPresale = l.status === STATUS_PRESALE;
  const lineColor = isPresale ? '#FFD700' : l.status === STATUS_BONDING_CURVE ? '#00ff88' : '#4488ff';
  const fillColor = isPresale ? 'rgba(255,215,0,0.06)' : 'rgba(0,255,136,0.06)';

  // Generate bonding curve visualization
  const points = 100;
  const maxTokens = Math.max(l.tokens_sold_curve * 2, l.total_supply * 0.1, 1000000);
  const prices = [];
  for (let i = 0; i <= points; i++) {
    const tokensSold = Math.floor((i / points) * maxTokens);
    prices.push(bondingCurvePrice(l.price_lamports, l.slope_scaled, tokensSold) / LAMPORTS_PER_SOL);
  }

  const minP = Math.min(...prices) * 0.95;
  const maxP = Math.max(...prices) * 1.05 || 0.001;
  const xStep = (w - pad.left - pad.right) / points;

  const toX = i => pad.left + i * xStep;
  const toY = p => pad.top + (1 - (p - minP) / (maxP - minP)) * (h - pad.top - pad.bottom);

  // Background
  ctx.fillStyle = '#080808';
  ctx.fillRect(0, 0, w, h);

  // Grid
  ctx.strokeStyle = '#1a1a1a';
  ctx.lineWidth = 1;
  for (let i = 0; i < 5; i++) {
    const y = pad.top + i * (h - pad.top - pad.bottom) / 4;
    ctx.beginPath(); ctx.moveTo(pad.left, y); ctx.lineTo(w - pad.right, y); ctx.stroke();
    const pVal = maxP - i * (maxP - minP) / 4;
    ctx.fillStyle = '#666';
    ctx.font = '10px JetBrains Mono';
    ctx.textAlign = 'left';
    ctx.fillText(pVal.toFixed(6), w - pad.right + 4, y + 3);
  }

  // Fill under curve
  ctx.beginPath();
  ctx.moveTo(toX(0), h - pad.bottom);
  prices.forEach((p, i) => ctx.lineTo(toX(i), toY(p)));
  ctx.lineTo(toX(points), h - pad.bottom);
  ctx.closePath();
  ctx.fillStyle = fillColor;
  ctx.fill();

  // Draw full curve line (dimmed)
  ctx.beginPath();
  ctx.moveTo(toX(0), toY(prices[0]));
  prices.forEach((p, i) => { if (i > 0) ctx.lineTo(toX(i), toY(p)); });
  ctx.strokeStyle = lineColor;
  ctx.globalAlpha = 0.3;
  ctx.lineWidth = 1;
  ctx.stroke();
  ctx.globalAlpha = 1;

  // Draw sold portion (bright)
  const soldRatio = l.tokens_sold_curve / maxTokens;
  const soldPoints = Math.round(soldRatio * points);
  if (soldPoints > 0) {
    ctx.beginPath();
    ctx.moveTo(toX(0), toY(prices[0]));
    for (let i = 1; i <= soldPoints; i++) ctx.lineTo(toX(i), toY(prices[i]));
    ctx.strokeStyle = lineColor;
    ctx.lineWidth = 2.5;
    ctx.stroke();

    // Current position dot
    const cx = toX(soldPoints);
    const cy = toY(prices[soldPoints]);
    ctx.beginPath();
    ctx.arc(cx, cy, 5, 0, Math.PI * 2);
    ctx.fillStyle = lineColor;
    ctx.fill();
    ctx.beginPath();
    ctx.arc(cx, cy, 10, 0, Math.PI * 2);
    ctx.strokeStyle = lineColor;
    ctx.globalAlpha = 0.3;
    ctx.lineWidth = 2;
    ctx.stroke();
    ctx.globalAlpha = 1;

    // Label current price
    ctx.fillStyle = lineColor;
    ctx.font = 'bold 11px JetBrains Mono';
    ctx.textAlign = 'center';
    ctx.fillText(formatSOL(bondingCurvePrice(l.price_lamports, l.slope_scaled, l.tokens_sold_curve)) + ' SOL', cx, cy - 14);
  }

  // X axis labels
  ctx.fillStyle = '#444';
  ctx.font = '9px JetBrains Mono';
  ctx.textAlign = 'center';
  ctx.fillText('0', pad.left, h - 6);
  ctx.fillText('Tokens Sold ‚Üí', (pad.left + w - pad.right) / 2, h - 6);
  ctx.fillText(maxTokens >= 1e6 ? (maxTokens/1e6).toFixed(0)+'M' : maxTokens.toLocaleString(), w - pad.right, h - 6);

  // Draw floor price line if bonding curve
  if (l.status === STATUS_BONDING_CURVE) {
    const floorY = toY(l.price_lamports / LAMPORTS_PER_SOL);
    ctx.setLineDash([4, 4]);
    ctx.beginPath();
    ctx.moveTo(pad.left, floorY);
    ctx.lineTo(w - pad.right, floorY);
    ctx.strokeStyle = 'rgba(255,215,0,0.3)';
    ctx.lineWidth = 1;
    ctx.stroke();
    ctx.setLineDash([]);
    ctx.fillStyle = 'rgba(255,215,0,0.5)';
    ctx.font = '9px JetBrains Mono';
    ctx.textAlign = 'left';
    ctx.fillText('floor', pad.left + 4, floorY - 4);
  }
}

// ‚îÄ‚îÄ Countdown timers ‚îÄ‚îÄ
setInterval(() => {
  const now = Math.floor(Date.now()/1000);
  document.querySelectorAll('[data-endtime]').forEach(el => {
    const end = parseInt(el.dataset.endtime);
    const diff = end - now;
    if (diff <= 0) { el.textContent = '00:00'; el.style.color='#ff6644'; return; }
    const m = Math.floor(diff / 60);
    const s = diff % 60;
    el.textContent = (m > 0 ? String(m).padStart(2,'0') + ':' : '') + String(s).padStart(2,'0');
    if (diff <= 10) el.style.color = '#ff6644';
  });
}, 1000);

// Filter chips
document.querySelectorAll('.filter-chip').forEach(chip => {
  chip.addEventListener('click', () => {
    document.querySelectorAll('.filter-chip').forEach(c => c.classList.remove('active'));
    chip.classList.add('active');
    const filter = chip.textContent.trim();
    document.querySelectorAll('.card').forEach(card => {
      if (filter.includes('All')) card.style.display = '';
      else if (filter.includes('Presale')) card.style.display = card.classList.contains('presale') ? '' : 'none';
      else if (filter.includes('Live')) card.style.display = card.classList.contains('live') ? '' : 'none';
      else card.style.display = '';
    });
  });
});

// Search (both topbar and filter bar)
function handleSearch(q) {
  q = q.toLowerCase();
  document.querySelectorAll('.card').forEach(card => {
    const name = card.querySelector('h3')?.textContent.toLowerCase() || '';
    const ticker = card.querySelector('.ticker-name')?.textContent.toLowerCase() || '';
    card.style.display = (name.includes(q) || ticker.includes(q)) ? '' : 'none';
  });
}
document.querySelector('.filter-search')?.addEventListener('input', e => handleSearch(e.target.value));
document.getElementById('topbarSearch')?.addEventListener('input', e => {
  handleSearch(e.target.value);
  // Also navigate to launches if not there
  if (window.location.hash !== '#launches' && e.target.value) navigate('launches');
});

// Close modals on overlay click
document.getElementById('buyModal').addEventListener('click', e => { if (e.target === e.currentTarget) closeBuyModal(); });

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// PROFILE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

async function loadProfile() {
  if (!walletPubkey) return;
  try {
    const res = await fetch(`${API_URL}/api/profile/${walletPubkey.toBase58()}`);
    userProfile = await res.json();
    if (!userProfile.username) {
      // First time ‚Äî show profile setup
      document.getElementById('profileModal').classList.add('open');
    }
  } catch(e) { console.warn('Profile load failed:', e); }
}

function closeProfileModal() {
  document.getElementById('profileModal').classList.remove('open');
}

let pfpFile = null;
function handlePfpUpload(e) {
  const file = e.target.files[0];
  if (!file) return;
  pfpFile = file;
  const reader = new FileReader();
  reader.onload = (ev) => {
    document.getElementById('pfpPreviewImg').src = ev.target.result;
    document.getElementById('pfpPreviewImg').style.display = 'block';
    document.getElementById('pfpPreviewEmoji').style.display = 'none';
  };
  reader.readAsDataURL(file);
}

async function saveProfile() {
  if (!walletPubkey) { toast('Connect wallet first', 'warning'); return; }
  const wallet = walletPubkey.toBase58();
  const username = document.getElementById('profileUsername').value.trim();
  const bio = document.getElementById('profileBio').value.trim();
  if (!username) { toast('Enter a username', 'warning'); return; }

  try {
    // Save text data
    await fetch(`${API_URL}/api/profile/${wallet}`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ username, bio })
    });

    // Upload PFP if selected
    if (pfpFile) {
      const form = new FormData();
      form.append('pfp', pfpFile);
      await fetch(`${API_URL}/api/profile/${wallet}/pfp`, { method: 'POST', body: form });
    }

    toast('Profile saved!', 'success');
    closeProfileModal();
    await loadProfile();
    // Update sidebar
    const btn = document.getElementById('walletBtn');
    btn.querySelector('.link-label').textContent = username;
  } catch(e) {
    toast('Failed to save profile: ' + e.message, 'error');
  }
}

// Open profile modal from sidebar
function openProfileModal() {
  if (!walletPubkey) { toast('Connect wallet first', 'warning'); return; }
  if (userProfile) {
    document.getElementById('profileUsername').value = userProfile.username || '';
    document.getElementById('profileBio').value = userProfile.bio || '';
    if (userProfile.pfp_url) {
      document.getElementById('pfpPreviewImg').src = API_URL + userProfile.pfp_url;
      document.getElementById('pfpPreviewImg').style.display = 'block';
      document.getElementById('pfpPreviewEmoji').style.display = 'none';
    }
  }
  document.getElementById('profileModal').classList.add('open');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// CHAT
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

async function loadChat(tokenAddress) {
  const container = document.getElementById('chatMessages');
  if (!container) return;
  try {
    const res = await fetch(`${API_URL}/api/chat/${tokenAddress}?limit=50`);
    const messages = await res.json();
    if (messages.length === 0) {
      container.innerHTML = '<div class="chat-empty">üí¨ No messages yet. Be the first to comment!</div>';
    } else {
      container.innerHTML = messages.map(renderChatMsg).join('');
      container.scrollTop = container.scrollHeight;
    }
    const countEl = document.getElementById('chatCount');
    if (countEl) countEl.textContent = messages.length + ' messages';
  } catch(e) {
    container.innerHTML = '<div class="chat-empty">Chat unavailable</div>';
  }
}

function renderChatMsg(m) {
  const name = m.username || shortAddr(m.wallet);
  const pfp = m.pfp_url ? `<img src="${API_URL}${m.pfp_url}">` : 'üë§';
  const ts = typeof m.created_at === 'string' ? Math.floor(new Date(m.created_at).getTime()/1000) : m.created_at;
  const time = timeAgo(ts);
  return `
    <div class="chat-msg">
      <div class="chat-pfp">${pfp}</div>
      <div class="chat-msg-body">
        <div class="chat-msg-header">
          <span class="chat-msg-user">${name}</span>
          <span class="chat-msg-wallet">${shortAddr(m.wallet)}</span>
          <span class="chat-msg-time">${time}</span>
        </div>
        <div class="chat-msg-text">${escapeHtml(m.message)}</div>
      </div>
    </div>`;
}

function escapeHtml(s) {
  return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
}

async function sendChatMessage(tokenAddress) {
  if (!walletPubkey) { toast('Connect wallet first', 'warning'); return; }
  const input = document.getElementById('chatInput');
  const msg = input.value.trim();
  if (!msg) return;

  const sendBtn = document.getElementById('chatSendBtn');
  sendBtn.disabled = true;

  try {
    const res = await fetch(`${API_URL}/api/chat/${tokenAddress}`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ wallet: walletPubkey.toBase58(), message: msg })
    });
    if (!res.ok) throw new Error('Send failed');
    input.value = '';
    await loadChat(tokenAddress);
  } catch(e) {
    toast('Failed to send message', 'error');
  } finally {
    sendBtn.disabled = false;
  }
}

function getChatHTML(tokenAddress) {
  return `
    <div class="chat-panel">
      <div class="chat-header">
        <h3>üí¨ Chat</h3>
        <span class="chat-count" id="chatCount"></span>
      </div>
      <div class="chat-messages" id="chatMessages">
        <div class="chat-empty">Loading...</div>
      </div>
      <div class="chat-input-area">
        <input class="chat-input" id="chatInput" placeholder="Write a message..." maxlength="500"
          onkeydown="if(event.key==='Enter'&&!event.shiftKey){event.preventDefault();sendChatMessage('${tokenAddress}')}">
        <button class="chat-send" id="chatSendBtn" onclick="sendChatMessage('${tokenAddress}')">Send</button>
      </div>
    </div>`;
}

// ‚îÄ‚îÄ Init ‚îÄ‚îÄ
loadOnchainLaunches();
setInterval(loadOnchainLaunches, 15000);
handleRoute();
</script>
</body>
</html>
<!-- cache bust 1772115502 -->
